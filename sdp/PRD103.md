# PRD-103: Hackathon Admin Platform 权限管理模块详细需求文档

## 1. 文档说明

### 1.1 文档目的
本文档基于 PRD-102，细化 Hackathon Admin Platform 中权限管理模块的功能需求，明确 Admin、主办方、赞助商三个角色的页面访问权限和操作权限。

### 1.2 文档范围
- 细化 Admin 系统的权限管理功能
- 明确各角色的页面访问权限
- 明确各角色的操作权限
- 提供权限验证规则和实现建议

### 1.3 基于文档
- PRD-102: Hackathon 比赛平台 - 第一期需求文档

**文档版本**: v1.0  
**创建日期**: 2024-01-XX  
**最后更新**: 2024-01-XX  
**维护人员**: 产品团队

---

## 2. 角色定义

| 角色 | 角色代码 | 描述 | 登录方式 |
|------|---------|------|----------|
| **系统管理员** | admin | 系统超级管理员，拥有最高权限，负责人员管理和系统维护 | 账号密码登录 |
| **主办方** | organizer | 负责创建和管理 Hackathon 活动的组织或个人 | 账号密码登录 |
| **赞助商** | sponsor | 为 Hackathon 活动提供赞助的企业或组织 | 账号密码登录 |

---

## 3. 页面访问权限矩阵

### 3.1 页面列表及访问权限

| 页面/模块 | 路由路径 | Admin | 主办方 | 赞助商 | 说明 |
|-----------|----------|-------|--------|--------|------|
| **登录页面** | `/login` | ✅ | ✅ | ✅ | 所有角色均可访问 |
| **仪表盘/首页** | `/dashboard` | ✅ | ✅ | ❌ | Admin和主办方可访问，赞助商第一期不可访问 |
| **人员管理页面** | `/users` | ✅ | ❌ | ❌ | 仅Admin可访问 |
| **活动列表页面** | `/hackathons` | ✅ | ✅ | ❌ | Admin和主办方可访问，赞助商第一期不可访问 |
| **活动创建页面** | `/hackathons/create` | ❌ | ✅ | ❌ | 仅主办方可访问 |
| **活动详情页面** | `/hackathons/:id` | ✅ | ✅ | ❌ | Admin可查看，主办方可查看和管理 |
| **活动编辑页面** | `/hackathons/:id/edit` | ❌ | ⚠️ | ❌ | 仅活动创建者可访问（需权限验证） |
| **活动阶段管理页面** | `/hackathons/:id/stages` | ❌ | ⚠️ | ❌ | 仅活动创建者可访问（需权限验证） |
| **个人中心页面** | `/profile` | ✅ | ✅ | ✅ | 所有角色均可访问自己的信息 |
| **系统设置页面** | `/settings` | ✅ | ✅ | ✅ | 所有角色均可访问自己的设置 |

**图例说明**：
- ✅ 可以访问
- ❌ 不能访问
- ⚠️ 有条件访问（需满足特定条件，如：仅活动创建者）

---

## 4. 详细操作权限矩阵

### 4.1 用户认证模块

| 操作 | Admin | 主办方 | 赞助商 | 备注 |
|------|-------|--------|--------|------|
| **登录** | ✅ | ✅ | ✅ | 账号密码登录，登录成功后根据角色跳转 |
| **登出** | ✅ | ✅ | ✅ | 所有角色均可登出 |
| **修改密码** | ✅ | ✅ | ✅ | 所有角色可修改自己的密码 |
| **查看个人信息** | ✅ | ✅ | ✅ | 所有角色可查看自己的信息（姓名、邮箱、角色等） |
| **修改个人信息** | ✅ | ✅ | ✅ | 所有角色可修改自己的部分信息（姓名、手机号等，不可修改邮箱和角色） |

---

### 4.2 人员管理模块（仅Admin）

| 操作 | Admin | 主办方 | 赞助商 | 备注 |
|------|-------|--------|--------|------|
| **查看人员列表** | ✅ | ❌ | ❌ | 显示所有人员（主办方、赞助商），支持分页 |
| **按角色筛选人员** | ✅ | ❌ | ❌ | 支持按主办方/赞助商筛选 |
| **按姓名/邮箱搜索** | ✅ | ❌ | ❌ | 支持搜索功能，实时搜索 |
| **分页查看人员** | ✅ | ❌ | ❌ | 支持分页显示，可设置每页显示数量 |
| **查看人员详情** | ✅ | ❌ | ❌ | 查看人员完整信息（姓名、邮箱、角色、手机号、创建时间等） |
| **添加主办方人员** | ✅ | ❌ | ❌ | 必填：姓名、邮箱、密码、角色（主办方）、手机号；邮箱需唯一性校验；密码需符合安全规范（至少8位，包含字母和数字） |
| **添加赞助商人员** | ✅ | ❌ | ❌ | 必填：姓名、邮箱、密码、角色（赞助商）、所属赞助商、手机号；邮箱需唯一性校验；密码需符合安全规范 |
| **编辑人员信息** | ✅ | ❌ | ❌ | 可修改姓名、手机号等信息；不可修改邮箱和角色；编辑前需确认权限 |
| **删除人员** | ✅ | ❌ | ❌ | 删除前需二次确认，提示删除后无法恢复；建议软删除，保留历史数据 |
| **重置人员密码** | ✅ | ❌ | ❌ | Admin可以重置其他人员的密码（需二次确认） |

---

### 4.3 活动管理模块

#### 4.3.1 活动列表操作

| 操作 | Admin | 主办方 | 赞助商 | 备注 |
|------|-------|--------|--------|------|
| **查看活动列表** | ✅ | ✅ | ❌ | 显示所有活动，Admin和主办方都可以看到所有活动 |
| **按活动状态筛选** | ✅ | ✅ | ❌ | 筛选：预备、发布、报名、签到、组队、提交、投票、公布结果 |
| **按活动名称搜索** | ✅ | ✅ | ❌ | 支持搜索功能，实时搜索 |
| **按创建时间排序** | ✅ | ✅ | ❌ | 升序/降序，默认按创建时间降序 |
| **按活动时间排序** | ✅ | ✅ | ❌ | 按开始时间或结束时间排序 |
| **分页查看活动** | ✅ | ✅ | ❌ | 支持分页显示，可设置每页显示数量 |
| **查看活动详情** | ✅ | ✅ | ❌ | 查看活动完整信息 |
| **批量操作（归档）** | ✅ | ⚠️ | ❌ | 仅活动创建者或Admin可以执行批量操作；批量操作前需确认权限 |

#### 4.3.2 活动创建/编辑操作

| 操作 | Admin | 主办方 | 赞助商 | 备注 |
|------|-------|--------|--------|------|
| **创建活动** | ❌ | ✅ | ❌ | 仅主办方可创建；创建后默认状态为"预备" |
| **编辑活动（预备状态）** | ❌ | ⚠️ | ❌ | 仅活动创建者可以编辑，且活动状态为"预备"时可编辑所有字段（名称、描述、时间、地点、奖项等） |
| **编辑活动（已发布）** | ❌ | ❌ | ❌ | 已发布的活动不可编辑基本信息，只能管理阶段 |
| **保存草稿** | ❌ | ⚠️ | ❌ | 仅活动创建者可以保存草稿；草稿保存后可以继续编辑 |
| **删除活动** | ❌ | ⚠️ | ❌ | 仅活动创建者可以删除，且仅可删除"预备"状态的活动；删除前需二次确认，提示删除后无法恢复；建议软删除 |
| **发布活动** | ❌ | ⚠️ | ❌ | 仅活动创建者可以发布，将活动从"预备"状态切换到"发布"状态；发布前需确认活动信息完整 |
| **归档活动** | ✅ | ⚠️ | ❌ | 仅活动创建者或Admin可以归档；已发布的活动可归档（软删除）；归档后活动不再显示在活动列表中，但数据保留 |
| **取消归档活动** | ✅ | ⚠️ | ❌ | 仅活动创建者或Admin可以取消归档；取消归档后活动恢复显示 |

#### 4.3.3 活动详情查看

| 操作 | Admin | 主办方 | 赞助商 | 备注 |
|------|-------|--------|--------|------|
| **查看活动基本信息** | ✅ | ✅ | ❌ | 名称、描述、时间、地点、奖项等完整信息 |
| **查看活动当前阶段** | ✅ | ✅ | ❌ | 显示活动当前处于哪个阶段（预备、发布、报名等） |
| **查看阶段时间安排** | ✅ | ✅ | ❌ | 显示各阶段的开始和结束时间，支持时间轴视图 |
| **查看活动统计信息** | ✅ | ✅ | ❌ | 报名人数、签到人数、组队数量、提交作品数量、投票数等统计信息 |
| **查看参与人员列表** | ✅ | ✅ | ❌ | 查看已报名、已签到的参赛者列表（仅显示基本信息，不显示钱包地址等敏感信息） |
| **查看队伍列表** | ✅ | ✅ | ❌ | 查看所有已组队的队伍信息（队伍名称、成员数量等） |
| **查看作品列表** | ✅ | ✅ | ❌ | 查看所有已提交的作品信息（作品名称、队伍信息等） |
| **导出活动数据** | ✅ | ⚠️ | ❌ | 仅活动创建者或Admin可以导出活动相关数据（Excel/CSV格式）；可导出报名数据、队伍数据、作品数据等 |

---

### 4.4 活动阶段管理模块

#### 4.4.1 阶段查看权限

| 操作 | Admin | 主办方 | 赞助商 | 备注 |
|------|-------|--------|--------|------|
| **查看阶段时间设置** | ❌ | ✅ | ❌ | 所有主办方可查看所有活动的阶段设置 |
| **查看时间轴视图** | ❌ | ✅ | ❌ | 所有主办方可查看活动的时间轴视图，直观展示各阶段时间安排 |
| **查看阶段切换日志** | ❌ | ✅ | ❌ | 所有主办方可查看阶段切换的历史记录（包括自动切换和手动切换） |

#### 4.4.2 阶段管理操作（仅活动创建者）

| 操作 | Admin | 主办方 | 赞助商 | 备注 |
|------|-------|--------|--------|------|
| **设置报名阶段时间** | ❌ | ⚠️ | ❌ | 仅活动创建者可以设置；需设置开始时间和结束时间；时间不能早于活动开始时间，不能晚于活动结束时间 |
| **设置签到阶段时间** | ❌ | ⚠️ | ❌ | 仅活动创建者可以设置；需设置开始时间和结束时间；开始时间不能早于报名阶段结束时间 |
| **设置组队阶段时间** | ❌ | ⚠️ | ❌ | 仅活动创建者可以设置；需设置开始时间和结束时间；开始时间不能早于签到阶段结束时间 |
| **设置提交阶段时间** | ❌ | ⚠️ | ❌ | 仅活动创建者可以设置；需设置开始时间和结束时间；开始时间不能早于组队阶段结束时间 |
| **设置投票阶段时间** | ❌ | ⚠️ | ❌ | 仅活动创建者可以设置；需设置开始时间和结束时间；开始时间不能早于提交阶段结束时间 |
| **手动切换活动阶段** | ❌ | ⚠️ | ❌ | 仅活动创建者可以手动切换活动阶段；切换前需确认；支持从当前阶段切换到下一阶段或指定阶段 |
| **时间冲突检测** | ❌ | ⚠️ | ❌ | 仅活动创建者设置时会进行冲突检测；检测各阶段时间是否重叠；如有冲突会提示并阻止保存 |
| **快速设置阶段时间** | ❌ | ⚠️ | ❌ | 仅活动创建者可以使用快速设置功能（如：报名阶段持续3天，签到阶段持续1天等） |

---

### 4.5 仪表盘/首页模块

| 操作 | Admin | 主办方 | 赞助商 | 备注 |
|------|-------|--------|--------|------|
| **查看系统概览** | ✅ | ✅ | ❌ | 显示系统整体统计信息 |
| **查看活动统计** | ✅ | ✅ | ❌ | 显示活动总数、各状态活动数量等 |
| **查看人员统计** | ✅ | ❌ | ❌ | 仅Admin可查看人员统计（主办方人数、赞助商人数等） |
| **查看最近活动** | ✅ | ✅ | ❌ | 显示最近创建或更新的活动列表 |
| **查看操作日志** | ✅ | ⚠️ | ❌ | Admin可查看所有操作日志；主办方可查看自己相关的操作日志 |

---

## 5. 权限限制详细说明

### 5.1 Admin权限限制

| 限制项 | 说明 |
|--------|------|
| **活动创建** | Admin不能创建活动，只能查看和管理 |
| **活动编辑** | Admin不能编辑活动基本信息，只能查看 |
| **活动删除** | Admin不能删除活动，但可以归档已发布的活动（软删除） |
| **活动阶段管理** | Admin不能管理活动阶段，只能查看阶段信息 |
| **人员管理** | Admin可以管理所有人员（主办方、赞助商），但不能修改自己的角色 |
| **数据访问** | Admin可以查看所有活动数据，但不能执行创建、编辑、删除操作 |

### 5.2 主办方权限限制

| 限制项 | 说明 |
|--------|------|
| **活动编辑** | 主办方只能编辑、删除、发布自己创建的活动；不能编辑其他主办方创建的活动 |
| **活动删除** | 只能删除处于"预备"状态的活动，且仅限自己创建的活动 |
| **活动发布** | 只能发布自己创建的活动 |
| **活动阶段管理** | 只能管理自己创建的活动阶段；可以查看所有活动的阶段信息，但不能修改 |
| **人员管理** | 主办方不能管理人员（不能添加、编辑、删除其他人员） |
| **数据访问** | 主办方可以查看所有活动数据，但只能管理自己创建的活动 |

### 5.3 赞助商权限限制

| 限制项 | 说明 |
|--------|------|
| **活动访问** | 第一期功能待定，不能访问活动管理相关页面 |
| **人员管理** | 不能访问人员管理页面 |
| **功能范围** | 第一期仅能登录系统，其他功能待后续版本规划 |

---

## 6. 数据访问范围

### 6.1 人员数据访问

| 数据类型 | Admin | 主办方 | 赞助商 | 说明 |
|----------|-------|--------|--------|------|
| **所有人员数据** | ✅ | ❌ | ❌ | Admin可查看所有人员（主办方、赞助商） |
| **个人账号信息** | ✅ | ✅ | ✅ | 所有角色可查看自己的信息 |

### 6.2 活动数据访问

| 数据类型 | Admin | 主办方 | 赞助商 | 说明 |
|----------|-------|--------|--------|------|
| **所有活动数据** | ✅ | ✅ | ❌ | Admin和主办方可查看所有活动 |
| **活动基本信息** | ✅ | ✅ | ❌ | 名称、描述、时间、地点、奖项等 |
| **活动统计数据** | ✅ | ✅ | ❌ | 报名人数、签到人数、组队数量、提交作品数量等 |
| **参与人员列表** | ✅ | ✅ | ❌ | 已报名、已签到的参赛者列表 |
| **队伍列表** | ✅ | ✅ | ❌ | 所有已组队的队伍信息 |
| **作品列表** | ✅ | ✅ | ❌ | 所有已提交的作品信息 |
| **投票数据** | ✅ | ✅ | ❌ | 投票统计和结果数据 |

### 6.3 系统数据访问

| 数据类型 | Admin | 主办方 | 赞助商 | 说明 |
|----------|-------|--------|--------|------|
| **操作日志** | ✅ | ⚠️ | ❌ | Admin可查看所有操作日志；主办方可查看自己相关的操作日志 |
| **阶段切换日志** | ✅ | ✅ | ❌ | 活动阶段切换的历史记录 |
| **系统配置** | ✅ | ❌ | ❌ | 仅Admin可访问系统配置 |

---

## 7. 权限验证规则

### 7.1 前端权限控制

| 控制项 | 实现方式 | 说明 |
|--------|----------|------|
| **菜单显示** | 根据用户角色显示/隐藏菜单项 | 使用角色判断，动态渲染菜单 |
| **路由守卫** | 根据用户角色控制路由访问 | 在路由守卫中验证角色权限 |
| **按钮显示** | 根据用户角色和操作权限显示/隐藏按钮 | 在组件中根据角色和权限条件渲染按钮 |
| **操作提示** | 无权限操作时显示提示信息 | 提示用户无权限执行该操作 |

### 7.2 后端权限验证

| 验证项 | 实现方式 | 说明 |
|--------|----------|------|
| **角色验证** | 中间件验证用户角色 | 所有API接口都需要进行角色验证 |
| **操作权限验证** | 验证用户是否有权限执行操作 | 验证用户角色和操作权限 |
| **数据权限验证** | 验证用户是否有权限访问数据 | 验证用户是否有权限访问特定数据（如：只能编辑自己创建的活动） |
| **资源所有权验证** | 验证用户是否是资源的创建者 | 验证用户是否是活动创建者，才能执行编辑、删除等操作 |
| **操作日志记录** | 记录所有重要操作 | 记录操作时间、操作人、操作内容等，便于审计 |

### 7.3 权限验证流程

```
1. 用户发起操作请求
2. 前端路由守卫验证（如有）
3. 后端中间件验证用户身份（JWT Token）
4. 后端中间件验证用户角色
5. 后端控制器验证操作权限
6. 后端服务层验证数据权限（如：是否是资源创建者）
7. 执行操作并记录日志
8. 返回操作结果
```

---

## 8. 特殊场景处理

### 8.1 活动编辑权限

| 场景 | 权限规则 | 说明 |
|------|----------|------|
| **预备状态** | 仅活动创建者可以编辑所有字段 | 活动创建者可以修改活动名称、描述、时间、地点、奖项等所有字段 |
| **发布状态及后续** | 活动创建者不能编辑活动基本信息，只能管理阶段 | 活动发布后，基本信息锁定，只能管理阶段时间 |
| **Admin查看** | Admin可以查看活动，但不能编辑 | Admin拥有查看权限，但没有编辑权限 |
| **其他主办方查看** | 其他主办方可以查看活动，但不能编辑 | 其他主办方可以查看所有活动，但不能编辑 |

### 8.2 活动删除权限

| 场景 | 权限规则 | 说明 |
|------|----------|------|
| **预备状态** | 仅活动创建者可以删除 | 只能删除处于"预备"状态的活动，且仅限自己创建的活动 |
| **已发布活动** | 不能删除，只能归档 | 已发布的活动不能删除，只能归档（软删除） |
| **删除确认** | 删除前需二次确认 | 删除前需弹出确认对话框，提示删除后无法恢复 |
| **软删除** | 建议使用软删除 | 删除后数据保留在数据库中，标记为已删除状态 |

### 8.3 批量操作权限

| 场景 | 权限规则 | 说明 |
|------|----------|------|
| **批量归档** | 仅活动创建者或Admin可以执行 | 批量操作前需验证权限，确保所有选中的活动都是当前用户创建的，或当前用户是Admin |
| **权限验证** | 批量操作前需验证每个资源的权限 | 验证每个活动是否可以被当前用户操作 |
| **操作日志** | 批量操作需记录操作日志 | 记录批量操作的操作人、操作时间、操作内容等 |

---

## 9. 实现建议

### 9.1 前端实现建议

1. **角色状态管理**
   - 使用状态管理工具（如 Redux、Zustand）存储用户角色信息
   - 登录成功后保存用户角色到状态管理中
   - 页面刷新时从 Token 中解析角色信息

2. **权限组件封装**
   - 封装权限控制组件，根据角色显示/隐藏内容
   - 封装权限路由守卫，控制路由访问
   - 封装权限按钮组件，根据权限显示/隐藏按钮

3. **菜单动态渲染**
   - 根据用户角色动态渲染菜单项
   - 不同角色显示不同的菜单结构

### 9.2 后端实现建议

1. **中间件设计**
   - 实现身份验证中间件（验证 JWT Token）
   - 实现角色验证中间件（验证用户角色）
   - 实现资源权限验证中间件（验证资源所有权）

2. **权限服务层**
   - 封装权限验证逻辑到服务层
   - 提供统一的权限验证接口
   - 支持细粒度的权限控制

3. **操作日志**
   - 记录所有重要操作（创建、编辑、删除、发布等）
   - 记录操作时间、操作人、操作内容、操作结果等
   - 支持操作日志查询和审计

---

## 10. 后续版本规划

### 10.1 赞助商功能规划

| 功能 | 优先级 | 说明 |
|------|--------|------|
| **查看相关活动** | 高 | 查看自己赞助的活动列表 |
| **查看活动统计数据** | 高 | 查看活动参与人数、报名人数等统计信息 |
| **查看活动详情** | 中 | 查看活动基本信息，但不能编辑 |
| **导出活动数据** | 中 | 导出自己赞助的活动相关数据 |
| **其他功能** | 低 | 待后续PRD定义 |

### 10.2 权限功能增强

| 功能 | 优先级 | 说明 |
|------|--------|------|
| **细粒度权限控制** | 中 | 支持更细粒度的权限控制（如：只读、编辑、删除等） |
| **角色自定义** | 低 | 支持自定义角色和权限配置 |
| **权限继承** | 低 | 支持权限继承机制 |
| **权限审计** | 中 | 增强权限审计功能，支持权限变更历史查询 |

---

## 附录：权限矩阵总览表

### A.1 页面访问权限总览

| 页面 | Admin | 主办方 | 赞助商 |
|------|-------|--------|--------|
| 登录页面 | ✅ | ✅ | ✅ |
| 仪表盘 | ✅ | ✅ | ❌ |
| 人员管理 | ✅ | ❌ | ❌ |
| 活动列表 | ✅ | ✅ | ❌ |
| 活动创建 | ❌ | ✅ | ❌ |
| 活动详情 | ✅ | ✅ | ❌ |
| 活动编辑 | ❌ | ⚠️ | ❌ |
| 阶段管理 | ❌ | ⚠️ | ❌ |
| 个人中心 | ✅ | ✅ | ✅ |

### A.2 核心操作权限总览

| 操作 | Admin | 主办方 | 赞助商 |
|------|-------|--------|--------|
| 添加人员 | ✅ | ❌ | ❌ |
| 编辑人员 | ✅ | ❌ | ❌ |
| 删除人员 | ✅ | ❌ | ❌ |
| 创建活动 | ❌ | ✅ | ❌ |
| 编辑活动 | ❌ | ⚠️ | ❌ |
| 删除活动 | ❌ | ⚠️ | ❌ |
| 发布活动 | ❌ | ⚠️ | ❌ |
| 归档活动 | ✅ | ⚠️ | ❌ |
| 管理阶段 | ❌ | ⚠️ | ❌ |
| 导出数据 | ✅ | ⚠️ | ❌ |

**图例说明**：
- ✅ 可以执行
- ❌ 不能执行
- ⚠️ 有条件执行（需满足特定条件，如：仅活动创建者）

---

**文档维护说明**：
- 本文档基于 PRD-102 需求文档细化权限管理模块
- 如有需求变更，请及时更新本文档
- 建议与开发团队确认权限细节后再实施
- 权限验证规则需前后端协同实现

