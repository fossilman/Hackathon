# PRD-104: Hackathon Arena Platform 参赛者功能详细需求文档

## 1. 文档说明

### 1.1 文档目的
本文档基于 PRD-102，细化 Hackathon Arena Platform 中参赛者角色的功能需求，明确参赛者在各个活动阶段的页面访问权限和操作权限，提供详细的功能规格说明。

### 1.2 文档范围
- 细化 Arena 平台的参赛者功能模块
- 明确参赛者在各活动阶段的页面访问权限
- 明确参赛者在各活动阶段的操作权限
- 提供详细的功能交互流程和实现建议

### 1.3 基于文档
- PRD-102: Hackathon 比赛平台 - 第一期需求文档

**文档版本**: v1.0  
**创建日期**: 2024-01-XX  
**最后更新**: 2024-01-XX  
**维护人员**: 产品团队

---

## 2. 角色定义

| 角色 | 角色代码 | 描述 | 登录方式 |
|------|---------|------|----------|
| **参赛者** | participant | 参与 Hackathon 比赛的个人或团队，通过 Metamask 钱包登录 | Metamask 钱包连接 |

### 2.1 参赛者状态定义

| 状态 | 状态代码 | 描述 | 说明 |
|------|---------|------|------|
| **未报名** | unregistered | 用户已登录但未报名活动 | 可以查看活动，但不能参与活动流程 |
| **已报名** | registered | 用户已报名活动但未签到 | 可以查看活动详情，但不能参与后续流程 |
| **已签到** | checked_in | 用户已报名并完成签到 | 可以参与组队、提交、投票等后续流程 |
| **已组队** | teamed | 用户已加入或创建队伍 | 可以参与提交作品、投票等流程 |
| **队长** | team_leader | 用户是队伍的队长 | 可以提交作品、管理队伍成员 |

---

## 3. 页面访问权限矩阵

### 3.1 页面列表及访问权限

| 页面/模块 | 路由路径 | 未登录 | 已登录 | 说明 |
|-----------|----------|--------|--------|------|
| **首页/活动列表** | `/` | ✅ | ✅ | 所有用户均可访问，显示已发布的活动 |
| **活动详情** | `/hackathons/:id` | ✅ | ✅ | 所有用户均可查看活动详情 |
| **登录页面** | `/login` | ✅ | ❌ | 未登录用户可访问，已登录用户自动跳转 |
| **我的活动** | `/my-hackathons` | ❌ | ✅ | 仅已登录用户可访问，显示已报名的活动 |
| **报名页面** | `/hackathons/:id/register` | ❌ | ⚠️ | 需登录且在报名阶段可访问 |
| **签到页面** | `/hackathons/:id/checkin` | ❌ | ⚠️ | 需登录、已报名且在签到阶段可访问 |
| **组队页面** | `/hackathons/:id/teams` | ❌ | ⚠️ | 需登录、已签到且在组队阶段可访问 |
| **创建队伍** | `/hackathons/:id/teams/create` | ❌ | ⚠️ | 需登录、已签到、未组队且在组队阶段可访问 |
| **队伍详情** | `/hackathons/:id/teams/:teamId` | ❌ | ⚠️ | 需登录且在组队阶段可访问 |
| **作品提交** | `/hackathons/:id/submit` | ❌ | ⚠️ | 需登录、是队长、已组队且在提交阶段可访问 |
| **作品列表** | `/hackathons/:id/submissions` | ❌ | ⚠️ | 需登录且在投票阶段可访问 |
| **投票页面** | `/hackathons/:id/vote` | ❌ | ⚠️ | 需登录、已签到且在投票阶段可访问 |
| **结果页面** | `/hackathons/:id/results` | ❌ | ⚠️ | 需登录且在公布结果阶段可访问 |
| **个人中心** | `/profile` | ❌ | ✅ | 仅已登录用户可访问 |

**图例说明**：
- ✅ 可以访问
- ❌ 不能访问
- ⚠️ 有条件访问（需满足特定条件，如：已登录、已报名、特定阶段等）

---

## 4. 详细操作权限矩阵

### 4.1 用户认证模块

| 操作 | 未登录 | 已登录 | 备注 |
|------|--------|--------|------|
| **连接 Metamask** | ✅ | ❌ | 未登录用户可以连接钱包 |
| **断开连接** | ❌ | ✅ | 已登录用户可以断开连接 |
| **切换钱包账户** | ❌ | ✅ | 已登录用户可以切换账户 |
| **查看钱包地址** | ❌ | ✅ | 已登录用户可以查看自己的钱包地址 |
| **首次签名验证** | ✅ | ❌ | 首次连接需要用户签名确认 |
| **查看个人信息** | ❌ | ✅ | 已登录用户可以查看自己的信息 |
| **修改个人信息** | ❌ | ✅ | 已登录用户可以修改自己的信息（如昵称等） |

---

### 4.2 活动浏览模块

#### 4.2.1 活动列表操作

| 操作 | 未登录 | 已登录 | 备注 |
|------|--------|--------|------|
| **查看活动列表** | ✅ | ✅ | 显示所有已发布的活动（状态为"发布"及后续阶段） |
| **按活动状态筛选** | ✅ | ✅ | 筛选：发布、报名、签到、组队、提交、投票、公布结果 |
| **按活动名称搜索** | ✅ | ✅ | 支持搜索功能，实时搜索 |
| **按活动时间排序** | ✅ | ✅ | 按开始时间或结束时间排序（即将开始、进行中、已结束） |
| **分页查看活动** | ✅ | ✅ | 支持分页显示，可设置每页显示数量 |
| **查看活动详情** | ✅ | ✅ | 查看活动完整信息 |
| **查看我的活动** | ❌ | ✅ | 仅已登录用户可以查看已报名的活动 |

#### 4.2.2 活动详情查看

| 操作 | 未登录 | 已登录 | 备注 |
|------|--------|--------|------|
| **查看活动基本信息** | ✅ | ✅ | 名称、描述、时间、地点、奖项等完整信息 |
| **查看活动当前阶段** | ✅ | ✅ | 显示活动当前处于哪个阶段 |
| **查看阶段时间安排** | ✅ | ✅ | 显示各阶段的开始和结束时间，支持时间轴视图 |
| **查看活动统计信息** | ✅ | ✅ | 报名人数、签到人数、组队数量、提交作品数量等 |
| **查看报名状态** | ❌ | ✅ | 已登录用户可以查看自己是否已报名 |
| **查看签到状态** | ❌ | ✅ | 已登录用户可以查看自己是否已签到 |
| **查看组队状态** | ❌ | ✅ | 已登录用户可以查看自己的组队状态 |
| **查看作品提交状态** | ❌ | ✅ | 已登录用户可以查看自己队伍的作品提交状态 |

---

### 4.3 报名模块

| 操作 | 未登录 | 已报名 | 已登录未报名 | 备注 |
|------|--------|--------|-------------|------|
| **查看报名按钮** | ❌ | ❌ | ⚠️ | 仅在报名阶段且未报名时显示 |
| **点击报名** | ❌ | ❌ | ⚠️ | 需在报名阶段且时间范围内 |
| **确认报名** | ❌ | ❌ | ⚠️ | 报名前需确认操作 |
| **查看报名状态** | ❌ | ✅ | ✅ | 已登录用户可以查看报名状态 |
| **取消报名** | ❌ | ⚠️ | ❌ | 仅在报名阶段内可以取消报名 |

**报名限制**：
- 仅在"报名"阶段可以报名
- 报名时间需在设定的时间范围内
- 同一用户不能重复报名同一活动
- 报名操作无需主办方审核，提交即生效

---

### 4.4 签到模块

| 操作 | 未报名 | 已报名未签到 | 已签到 | 备注 |
|------|--------|-------------|--------|------|
| **查看签到按钮** | ❌ | ⚠️ | ❌ | 仅在签到阶段且已报名未签到时显示 |
| **点击签到** | ❌ | ⚠️ | ❌ | 需在签到阶段且时间范围内 |
| **确认签到** | ❌ | ⚠️ | ❌ | 签到前需确认操作 |
| **查看签到状态** | ❌ | ✅ | ✅ | 已报名用户可以查看签到状态 |
| **取消签到** | ❌ | ❌ | ❌ | 签到后不能取消 |

**签到限制**：
- 仅在"签到"阶段可以签到
- 签到时间需在设定的时间范围内
- 仅已报名的用户可以进行签到
- 同一用户不能重复签到
- 签到操作无需主办方审核，提交即生效

---

### 4.5 组队模块

#### 4.5.1 组队操作权限

| 操作 | 未签到 | 已签到未组队 | 已组队（队长） | 已组队（队员） | 备注 |
|------|--------|-------------|---------------|--------------|------|
| **查看组队页面** | ❌ | ⚠️ | ⚠️ | ⚠️ | 需在组队阶段且已签到 |
| **创建队伍** | ❌ | ⚠️ | ❌ | ❌ | 需在组队阶段且未组队 |
| **查看队伍列表** | ❌ | ⚠️ | ⚠️ | ⚠️ | 需在组队阶段且已签到 |
| **加入队伍** | ❌ | ⚠️ | ❌ | ❌ | 需在组队阶段且未组队 |
| **查看队伍详情** | ❌ | ⚠️ | ⚠️ | ⚠️ | 需在组队阶段且已签到 |
| **修改队伍信息** | ❌ | ❌ | ⚠️ | ❌ | 仅队长可以修改，且需在组队阶段内 |
| **移除队伍成员** | ❌ | ❌ | ⚠️ | ❌ | 仅队长可以移除，不能移除自己 |
| **解散队伍** | ❌ | ❌ | ⚠️ | ❌ | 仅队长可以解散，需确认 |
| **退出队伍** | ❌ | ❌ | ❌ | ⚠️ | 仅队员可以退出，需确认 |

#### 4.5.2 组队限制说明

| 限制项 | 说明 |
|--------|------|
| **阶段限制** | 仅在"组队"阶段可以组队 |
| **时间限制** | 组队时间需在设定的时间范围内 |
| **状态限制** | 仅已签到的用户可以进行组队 |
| **重复限制** | 同一用户不能同时加入多个队伍 |
| **成员限制** | 每个队伍至少需要 1 名成员（队长），最多成员数由活动设置决定（默认值3，可配置，范围1-10） |
| **阶段结束后** | 组队阶段结束后，队伍成员不能变更，未组队的用户不能继续组队 |

---

### 4.6 作品提交模块

| 操作 | 未组队 | 已组队（队长） | 已组队（队员） | 备注 |
|------|--------|---------------|--------------|------|
| **查看提交页面** | ❌ | ⚠️ | ❌ | 需在提交阶段且是队长 |
| **填写作品信息** | ❌ | ⚠️ | ❌ | 需在提交阶段且是队长 |
| **保存草稿** | ❌ | ⚠️ | ❌ | 需在提交阶段且是队长 |
| **提交作品** | ❌ | ⚠️ | ❌ | 需在提交阶段且是队长 |
| **修改作品** | ❌ | ⚠️ | ❌ | 需在提交阶段内且是队长 |
| **查看作品详情** | ❌ | ⚠️ | ⚠️ | 队长和队员都可以查看自己队伍的作品 |
| **删除作品** | ❌ | ❌ | ❌ | 提交后不能删除，只能修改 |

**提交限制**：
- 仅在"提交"阶段可以提交作品
- 提交时间需在设定的时间范围内
- 仅已组队的队伍可以提交作品
- 仅队长可以提交作品
- 每个队伍只能提交一个作品
- 提交后可以修改（在提交阶段内）
- 提交阶段结束后不能修改

**提交内容**：
- 必填字段：作品名称（1-100字符）、作品描述（支持富文本，最多2000字符）、作品链接（需URL格式校验）
- 支持保存草稿功能

---

### 4.7 投票模块

| 操作 | 未签到 | 已签到 | 备注 |
|------|--------|--------|------|
| **查看投票页面** | ❌ | ⚠️ | 需在投票阶段且已签到 |
| **查看作品列表** | ❌ | ⚠️ | 需在投票阶段且已签到 |
| **查看作品详情** | ❌ | ⚠️ | 需在投票阶段且已签到 |
| **对作品投票** | ❌ | ⚠️ | 需在投票阶段且已签到 |
| **取消投票** | ❌ | ⚠️ | 需在投票阶段内且已签到 |
| **查看投票记录** | ❌ | ⚠️ | 需在投票阶段且已签到 |
| **查看实时得票数** | ❌ | ⚠️ | 需在投票阶段且已签到 |

**投票限制**：
- 仅在"投票"阶段可以投票
- 投票时间需在设定的时间范围内
- 仅已签到的用户可以进行投票
- 每个用户可以对多个作品投票（需明确投票数量限制，如：最多投3票，或对所有作品投票）
- 每个用户对同一作品只能投票一次
- 用户能对自己的队伍作品投票（需明确是否允许）
- 投票需确认操作（防止误操作）

**投票规则**（待明确）：
- 投票数量限制：每个用户最多可以投几票？（建议：最多投3票，或对所有作品投票）
- 是否允许对自己的队伍作品投票？（建议：允许）

---

### 4.8 结果查看模块

| 操作 | 未登录 | 已登录 | 备注 |
|------|--------|--------|------|
| **查看结果页面** | ❌ | ⚠️ | 需在公布结果阶段且已登录 |
| **查看最终排名** | ❌ | ⚠️ | 需在公布结果阶段且已登录 |
| **查看获奖队伍** | ❌ | ⚠️ | 需在公布结果阶段且已登录 |
| **查看作品得票数** | ❌ | ⚠️ | 需在公布结果阶段且已登录 |
| **查看详细统计** | ❌ | ⚠️ | 需在公布结果阶段且已登录 |
| **导出结果** | ❌ | ❌ | 第一期不支持导出功能 |

**结果展示内容**：
- 最终排名（按得票数排序）
- 获奖队伍信息（排名、队伍名称、作品名称、得票数、奖项信息）
- 各作品的得票数
- 统计数据（总投票数、参与队伍数等）

---

## 5. 活动阶段权限矩阵

### 5.1 各阶段可执行操作总览

| 操作 | 发布 | 报名 | 签到 | 组队 | 提交 | 投票 | 公布结果 |
|------|------|------|------|------|------|------|----------|
| **查看活动列表** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **查看活动详情** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **报名** | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| **签到** | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ |
| **创建/加入队伍** | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ |
| **管理队伍** | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ |
| **提交作品** | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ |
| **修改作品** | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ |
| **查看作品列表** | ❌ | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ |
| **投票** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |
| **查看结果** | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |

---

### 5.2 阶段状态与用户状态组合权限

| 活动阶段 | 用户状态 | 可执行操作 |
|----------|----------|-----------|
| **发布** | 未登录 | 查看活动列表、查看活动详情 |
| **发布** | 已登录未报名 | 查看活动列表、查看活动详情、查看我的活动 |
| **发布** | 已报名未签到 | 查看活动列表、查看活动详情、查看我的活动、查看报名状态 |
| **发布** | 已签到 | 查看活动列表、查看活动详情、查看我的活动、查看报名和签到状态 |
| **报名** | 未登录 | 查看活动列表、查看活动详情 |
| **报名** | 已登录未报名 | 查看活动列表、查看活动详情、报名、查看我的活动 |
| **报名** | 已报名未签到 | 查看活动列表、查看活动详情、查看我的活动、查看报名状态、取消报名 |
| **报名** | 已签到 | 查看活动列表、查看活动详情、查看我的活动、查看报名和签到状态 |
| **签到** | 已报名未签到 | 查看活动列表、查看活动详情、签到、查看我的活动 |
| **签到** | 已签到 | 查看活动列表、查看活动详情、查看我的活动、查看签到状态 |
| **组队** | 已签到未组队 | 查看活动列表、查看活动详情、创建队伍、加入队伍、查看我的活动 |
| **组队** | 已组队（队长） | 查看活动列表、查看活动详情、查看队伍详情、管理队伍、修改队伍信息、查看我的活动 |
| **组队** | 已组队（队员） | 查看活动列表、查看活动详情、查看队伍详情、退出队伍、查看我的活动 |
| **提交** | 已组队（队长） | 查看活动列表、查看活动详情、提交作品、修改作品、查看作品详情、查看我的活动 |
| **提交** | 已组队（队员） | 查看活动列表、查看活动详情、查看作品详情、查看我的活动 |
| **投票** | 已签到 | 查看活动列表、查看活动详情、查看作品列表、投票、取消投票、查看投票记录、查看我的活动 |
| **公布结果** | 已登录 | 查看活动列表、查看活动详情、查看结果、查看排名、查看获奖队伍、查看我的活动 |

---

## 6. 数据访问范围

### 6.1 活动数据访问

| 数据类型 | 未登录 | 已登录 | 说明 |
|----------|--------|--------|------|
| **活动基本信息** | ✅ | ✅ | 名称、描述、时间、地点、奖项等 |
| **活动当前阶段** | ✅ | ✅ | 显示活动当前处于哪个阶段 |
| **阶段时间安排** | ✅ | ✅ | 各阶段的开始和结束时间 |
| **活动统计信息** | ✅ | ✅ | 报名人数、签到人数、组队数量、提交作品数量等 |
| **个人报名状态** | ❌ | ✅ | 已登录用户可以查看自己的报名状态 |
| **个人签到状态** | ❌ | ✅ | 已登录用户可以查看自己的签到状态 |
| **个人组队状态** | ❌ | ✅ | 已登录用户可以查看自己的组队状态 |
| **个人作品状态** | ❌ | ✅ | 已登录用户可以查看自己队伍的作品状态 |

### 6.2 队伍数据访问

| 数据类型 | 未组队 | 已组队（队长） | 已组队（队员） | 说明 |
|----------|--------|---------------|--------------|------|
| **队伍列表** | ⚠️ | ✅ | ✅ | 在组队阶段可以查看所有队伍列表 |
| **队伍基本信息** | ⚠️ | ✅ | ✅ | 队伍名称、成员数量等基本信息 |
| **队伍成员列表** | ❌ | ✅ | ✅ | 队长和队员都可以查看队伍成员 |
| **队伍详细信息** | ❌ | ✅ | ✅ | 队长和队员都可以查看队伍详细信息 |
| **其他队伍详情** | ⚠️ | ✅ | ✅ | 在组队阶段可以查看其他队伍的公开信息（用于加入队伍） |

### 6.3 作品数据访问

| 数据类型 | 未提交 | 已提交（队长） | 已提交（队员） | 其他用户 | 说明 |
|----------|--------|---------------|--------------|---------|------|
| **自己队伍的作品** | ❌ | ✅ | ✅ | ❌ | 队长和队员都可以查看自己队伍的作品 |
| **作品列表** | ❌ | ⚠️ | ⚠️ | ⚠️ | 在投票阶段，所有已签到的用户都可以查看作品列表 |
| **作品详情** | ❌ | ⚠️ | ⚠️ | ⚠️ | 在投票阶段，所有已签到的用户都可以查看作品详情 |
| **作品得票数** | ❌ | ⚠️ | ⚠️ | ⚠️ | 在投票阶段，实时显示得票数；在公布结果阶段，显示最终得票数 |

### 6.4 投票数据访问

| 数据类型 | 未投票 | 已投票 | 说明 |
|----------|--------|--------|------|
| **个人投票记录** | ❌ | ✅ | 已投票用户可以查看自己的投票记录 |
| **作品得票数** | ⚠️ | ✅ | 在投票阶段，实时显示得票数 |
| **投票统计** | ❌ | ⚠️ | 在公布结果阶段，显示投票统计信息 |

### 6.5 结果数据访问

| 数据类型 | 访问权限 | 说明 |
|----------|----------|------|
| **最终排名** | ⚠️ | 在公布结果阶段，所有已登录用户可以查看 |
| **获奖队伍信息** | ⚠️ | 在公布结果阶段，所有已登录用户可以查看 |
| **作品得票数** | ⚠️ | 在公布结果阶段，所有已登录用户可以查看 |
| **统计数据** | ⚠️ | 在公布结果阶段，所有已登录用户可以查看 |

---

## 7. 功能详细规格说明

### 7.1 Metamask 钱包连接功能

#### 7.1.1 连接流程

1. **检测 Metamask**
   - 页面加载时自动检测用户是否安装 Metamask 插件
   - 如未安装，显示安装指引（包括下载链接和安装步骤）
   - 如已安装，显示"连接钱包"按钮

2. **连接钱包**
   - 用户点击"连接钱包"按钮
   - 调用 `window.ethereum.request({ method: 'eth_requestAccounts' })`
   - 用户确认连接后，获取钱包地址
   - 将钱包地址发送到后端进行验证

3. **身份验证**
   - 首次连接需要用户签名确认（用于身份验证）
   - 生成签名消息（如："请签名以验证您的身份"）
   - 调用 `window.ethereum.request({ method: 'personal_sign', params: [message, address] })`
   - 将签名发送到后端验证
   - 验证成功后，后端返回 JWT Token 或 Session

4. **保存登录状态**
   - 将 Token 保存到 localStorage 或 SessionStorage
   - 将钱包地址保存到状态管理中
   - 更新 UI 显示已连接状态

#### 7.1.2 切换账户

- 监听 `window.ethereum.on('accountsChanged', callback)` 事件
- 当用户切换账户时，自动更新钱包地址
- 重新进行身份验证（签名确认）
- 更新登录状态和用户信息

#### 7.1.3 断开连接

- 用户点击"断开连接"按钮
- 清除 Token 和钱包地址
- 清除状态管理中的数据
- 跳转到登录页面

---

### 7.2 活动浏览功能

#### 7.2.1 活动列表页面

**页面布局**：
- 顶部：搜索框、筛选器（活动状态、时间排序）
- 中部：活动卡片列表（支持网格布局和列表布局切换）
- 底部：分页组件

**活动卡片信息**：
- 活动名称
- 活动描述（摘要，最多100字符，超出显示省略号）
- 活动时间（开始时间 - 结束时间）
- 活动地点（线上/线下/混合）
- 当前阶段（带状态标签）
- 参与人数（报名人数）
- 操作按钮（根据用户状态和活动阶段显示：查看详情、报名、签到等）

**筛选功能**：
- 按活动状态筛选：发布、报名、签到、组队、提交、投票、公布结果
- 按活动时间排序：即将开始、进行中、已结束
- 按活动名称搜索：实时搜索，支持模糊匹配

**分页功能**：
- 默认每页显示 12 个活动
- 支持设置每页显示数量（12、24、48）
- 显示总页数和当前页码

#### 7.2.2 活动详情页面

**页面布局**：
- 顶部：活动标题、当前阶段标签
- 左侧：活动基本信息、阶段时间轴
- 右侧：操作按钮区域、统计信息
- 底部：活动描述、奖项设置

**活动基本信息**：
- 活动名称
- 活动描述（完整内容，支持富文本显示）
- 活动时间（开始时间 - 结束时间）
- 活动地点（线上/线下/混合，如选择线下或混合显示具体地址）
- 奖项设置（列表展示，包含奖项名称、奖金/奖品、数量）

**阶段时间轴**：
- 可视化展示各阶段的开始和结束时间
- 当前阶段高亮显示
- 已完成的阶段显示为已完成状态
- 未开始的阶段显示为未开始状态

**统计信息**：
- 报名人数
- 签到人数
- 组队数量
- 提交作品数量

**操作按钮**（根据用户状态和活动阶段动态显示）：
- 未登录：显示"连接钱包"按钮
- 已登录未报名：在报名阶段显示"报名"按钮
- 已报名未签到：在签到阶段显示"签到"按钮
- 已签到未组队：在组队阶段显示"创建队伍"和"加入队伍"按钮
- 已组队：显示"查看队伍"按钮
- 已组队（队长）：在提交阶段显示"提交作品"按钮
- 已签到：在投票阶段显示"投票"按钮
- 已登录：在公布结果阶段显示"查看结果"按钮

---

### 7.3 报名功能

#### 7.3.1 报名流程

1. **进入报名页面**
   - 用户点击活动详情页的"报名"按钮
   - 或直接访问 `/hackathons/:id/register` 路由
   - 验证用户是否已登录（未登录跳转到登录页面）
   - 验证活动是否在报名阶段（不在报名阶段显示提示信息）

2. **报名确认**
   - 显示报名确认对话框
   - 显示活动基本信息（名称、时间、地点等）
   - 显示报名须知（如：报名后不能取消、需按时签到等）
   - 用户确认后执行报名操作

3. **执行报名**
   - 发送报名请求到后端（包含：用户钱包地址、活动ID）
   - 后端验证：用户是否已报名、活动是否在报名阶段、报名时间是否在范围内
   - 验证通过后，创建报名记录
   - 返回报名成功信息

4. **报名成功**
   - 显示报名成功提示
   - 更新用户状态为"已报名"
   - 更新活动统计信息（报名人数+1）
   - 跳转到活动详情页面或"我的活动"页面

#### 7.3.2 报名状态显示

- 在活动详情页面显示报名状态（已报名/未报名）
- 在"我的活动"页面显示已报名的活动列表
- 报名状态标签（已报名、未报名）

#### 7.3.3 取消报名

- 仅在报名阶段内可以取消报名
- 取消报名前需确认操作
- 取消报名后，用户状态恢复为"未报名"
- 更新活动统计信息（报名人数-1）

---

### 7.4 签到功能

#### 7.4.1 签到流程

1. **进入签到页面**
   - 用户点击活动详情页的"签到"按钮
   - 或直接访问 `/hackathons/:id/checkin` 路由
   - 验证用户是否已登录（未登录跳转到登录页面）
   - 验证用户是否已报名（未报名显示提示信息）
   - 验证活动是否在签到阶段（不在签到阶段显示提示信息）

2. **签到确认**
   - 显示签到确认对话框
   - 显示活动基本信息
   - 显示签到须知（如：签到后可以参与后续流程等）
   - 用户确认后执行签到操作

3. **执行签到**
   - 发送签到请求到后端（包含：用户钱包地址、活动ID）
   - 后端验证：用户是否已报名、用户是否已签到、活动是否在签到阶段、签到时间是否在范围内
   - 验证通过后，创建签到记录
   - 返回签到成功信息

4. **签到成功**
   - 显示签到成功提示
   - 更新用户状态为"已签到"
   - 更新活动统计信息（签到人数+1）
   - 跳转到活动详情页面

#### 7.4.2 签到状态显示

- 在活动详情页面显示签到状态（已签到/未签到）
- 签到状态标签（已签到、未签到）

---

### 7.5 组队功能

#### 7.5.1 创建队伍流程

1. **进入创建队伍页面**
   - 用户点击活动详情页的"创建队伍"按钮
   - 或直接访问 `/hackathons/:id/teams/create` 路由
   - 验证用户是否已登录（未登录跳转到登录页面）
   - 验证用户是否已签到（未签到显示提示信息）
   - 验证用户是否已组队（已组队显示提示信息）
   - 验证活动是否在组队阶段（不在组队阶段显示提示信息）

2. **填写队伍信息**
   - 队伍名称（必填，1-50字符）
   - 队伍成员上限（默认值3，包含队长，可配置，范围1-10）
   - 队伍描述（可选，最多200字符）

3. **创建队伍**
   - 发送创建队伍请求到后端（包含：队伍名称、成员上限、活动ID、创建者钱包地址）
   - 后端验证：队伍名称是否唯一、用户是否已组队、活动是否在组队阶段
   - 验证通过后，创建队伍记录
   - 创建者自动成为队长
   - 返回创建成功信息

4. **创建成功**
   - 显示创建成功提示
   - 更新用户状态为"已组队（队长）"
   - 更新活动统计信息（组队数量+1）
   - 跳转到队伍详情页面

#### 7.5.2 加入队伍流程

1. **查看队伍列表**
   - 用户点击活动详情页的"加入队伍"按钮
   - 或直接访问 `/hackathons/:id/teams` 路由
   - 显示所有可加入的队伍列表（未满员的队伍）

2. **选择队伍**
   - 显示队伍信息：队伍名称、当前成员数/最大成员数、创建时间
   - 支持按队伍名称搜索
   - 支持按创建时间排序

3. **加入队伍**
   - 用户点击"加入"按钮
   - 显示加入确认对话框
   - 用户确认后发送加入请求到后端
   - 后端验证：队伍是否满员、用户是否已组队、活动是否在组队阶段
   - 验证通过后，将用户添加到队伍
   - 返回加入成功信息

4. **加入成功**
   - 显示加入成功提示
   - 更新用户状态为"已组队（队员）"
   - 跳转到队伍详情页面

#### 7.5.3 队伍管理功能

**队长权限**：
- 查看队伍成员列表（显示成员钱包地址、加入时间等）
- 移除队伍成员（不能移除自己，移除前需确认）
- 解散队伍（需确认，解散后所有成员恢复未组队状态）
- 修改队伍信息（队伍名称、成员上限，在组队阶段内）

**队员权限**：
- 查看队伍成员列表
- 退出队伍（需确认，退出后可以重新组队）

**队伍详情页面**：
- 显示队伍基本信息：队伍名称、成员上限、创建时间
- 显示成员列表：成员钱包地址、角色（队长/队员）、加入时间
- 显示操作按钮（根据用户角色显示：管理队伍、退出队伍等）

---

### 7.6 作品提交功能

#### 7.6.1 提交作品流程

1. **进入提交页面**
   - 队长点击活动详情页的"提交作品"按钮
   - 或直接访问 `/hackathons/:id/submit` 路由
   - 验证用户是否已登录（未登录跳转到登录页面）
   - 验证用户是否是队长（不是队长显示提示信息）
   - 验证用户是否已组队（未组队显示提示信息）
   - 验证活动是否在提交阶段（不在提交阶段显示提示信息）

2. **填写作品信息**
   - 作品名称（必填，1-100字符）
   - 作品描述（必填，支持富文本，最多2000字符）
   - 作品链接（必填，GitHub、演示地址等，需URL格式校验）
   - 支持保存草稿功能

3. **提交作品**
   - 用户点击"提交"按钮
   - 表单验证：必填字段、字符长度、URL格式等
   - 验证通过后，发送提交请求到后端
   - 后端验证：用户是否是队长、队伍是否已提交、活动是否在提交阶段
   - 验证通过后，创建或更新作品记录
   - 返回提交成功信息

4. **提交成功**
   - 显示提交成功提示
   - 更新作品状态为"已提交"
   - 更新活动统计信息（提交作品数量+1）
   - 跳转到作品详情页面

#### 7.6.2 修改作品流程

- 在提交阶段内，队长可以修改作品信息
- 修改流程与提交流程相同
- 修改后更新作品记录
- 显示修改成功提示

#### 7.6.3 作品展示

**作品列表页面**（在投票阶段）：
- 显示所有已提交的作品
- 作品卡片信息：作品名称、作品描述（摘要）、队伍名称、提交时间、得票数
- 支持按作品名称搜索
- 支持按提交时间排序
- 支持按得票数排序

**作品详情页面**：
- 显示作品完整信息：作品名称、作品描述（完整内容）、作品链接、提交时间
- 显示队伍信息：队伍名称、成员列表
- 显示得票数（在投票阶段和公布结果阶段）

---

### 7.7 投票功能

#### 7.7.1 投票流程

1. **进入投票页面**
   - 用户点击活动详情页的"投票"按钮
   - 或直接访问 `/hackathons/:id/vote` 路由
   - 验证用户是否已登录（未登录跳转到登录页面）
   - 验证用户是否已签到（未签到显示提示信息）
   - 验证活动是否在投票阶段（不在投票阶段显示提示信息）

2. **浏览作品**
   - 显示所有已提交的作品列表
   - 支持按作品名称搜索
   - 支持按提交时间排序
   - 支持按得票数排序
   - 点击作品卡片查看作品详情

3. **投票操作**
   - 用户点击"投票"按钮
   - 显示投票确认对话框
   - 显示作品信息（作品名称、队伍名称等）
   - 显示投票规则（如：每个用户最多投3票，对同一作品只能投一次）
   - 用户确认后执行投票操作

4. **执行投票**
   - 发送投票请求到后端（包含：用户钱包地址、作品ID、活动ID）
   - 后端验证：用户是否已签到、用户是否已投票、投票数量是否超限、活动是否在投票阶段
   - 验证通过后，创建投票记录
   - 返回投票成功信息

5. **投票成功**
   - 显示投票成功提示
   - 更新作品得票数（实时更新）
   - 更新用户投票记录
   - 更新投票统计信息

#### 7.7.2 取消投票流程

- 在投票阶段内，用户可以取消已投的票
- 用户点击"取消投票"按钮
- 显示取消投票确认对话框
- 用户确认后执行取消投票操作
- 更新作品得票数（实时更新）
- 更新用户投票记录

#### 7.7.3 投票记录查看

- 用户可以查看自己的投票记录
- 显示已投票的作品列表
- 显示投票时间
- 支持取消投票（在投票阶段内）

#### 7.7.4 实时得票数显示

- 在投票阶段，实时显示各作品的得票数
- 投票后立即更新得票数
- 支持按得票数排序

---

### 7.8 结果查看功能

#### 7.8.1 结果页面布局

**页面结构**：
- 顶部：活动名称、当前阶段标签
- 中部：排名列表（按得票数排序）
- 底部：统计数据

**排名列表**：
- 显示所有作品的排名（按得票数从高到低排序）
- 排名信息：排名、作品名称、队伍名称、得票数、奖项信息
- 获奖作品高亮显示
- 支持查看作品详情

**获奖队伍信息**：
- 显示获奖队伍列表
- 显示奖项信息（一等奖、二等奖、三等奖等）
- 显示奖金/奖品信息

**统计数据**：
- 总投票数
- 参与队伍数
- 参与人数
- 其他统计信息

#### 7.8.2 结果查看流程

1. **进入结果页面**
   - 用户点击活动详情页的"查看结果"按钮
   - 或直接访问 `/hackathons/:id/results` 路由
   - 验证用户是否已登录（未登录跳转到登录页面）
   - 验证活动是否在公布结果阶段（不在公布结果阶段显示提示信息）

2. **查看结果**
   - 显示最终排名列表
   - 显示获奖队伍信息
   - 显示各作品的得票数
   - 显示统计数据

3. **查看作品详情**
   - 点击作品可以查看作品详情
   - 显示作品完整信息
   - 显示队伍信息
   - 显示得票数和排名

---

## 8. 特殊场景处理

### 8.1 阶段切换场景

| 场景 | 处理方式 | 说明 |
|------|----------|------|
| **报名阶段结束** | 锁定报名功能，已报名用户状态不变 | 报名阶段结束后，不能再报名，但已报名的用户可以继续后续流程 |
| **签到阶段结束** | 锁定签到功能，已签到用户状态不变 | 签到阶段结束后，不能再签到，但已签到的用户可以继续后续流程 |
| **组队阶段结束** | 锁定组队功能，已组队用户状态不变 | 组队阶段结束后，不能再组队，但已组队的用户可以继续后续流程 |
| **提交阶段结束** | 锁定提交和修改功能 | 提交阶段结束后，不能再提交或修改作品 |
| **投票阶段结束** | 锁定投票功能，统计投票结果 | 投票阶段结束后，不能再投票，系统统计最终投票结果 |
| **公布结果阶段** | 解锁结果查看功能 | 公布结果阶段，所有已登录用户可以查看结果 |

### 8.2 用户状态异常场景

| 场景 | 处理方式 | 说明 |
|------|----------|------|
| **未报名但尝试签到** | 显示提示信息，引导用户先报名 | 提示"请先报名活动" |
| **未签到但尝试组队** | 显示提示信息，引导用户先签到 | 提示"请先完成签到" |
| **未组队但尝试提交作品** | 显示提示信息，引导用户先组队 | 提示"请先组队" |
| **不是队长但尝试提交作品** | 显示提示信息，提示只有队长可以提交 | 提示"只有队长可以提交作品" |
| **未签到但尝试投票** | 显示提示信息，引导用户先签到 | 提示"请先完成签到" |

### 8.3 时间限制场景

| 场景 | 处理方式 | 说明 |
|------|----------|------|
| **报名时间已过** | 隐藏报名按钮，显示提示信息 | 提示"报名时间已过" |
| **签到时间未到** | 隐藏签到按钮，显示倒计时 | 显示"签到将在XX时间开始" |
| **组队时间已过** | 隐藏组队按钮，显示提示信息 | 提示"组队时间已过" |
| **提交时间已过** | 隐藏提交按钮，显示提示信息 | 提示"提交时间已过" |
| **投票时间已过** | 隐藏投票按钮，显示提示信息 | 提示"投票时间已过" |

### 8.4 重复操作场景

| 场景 | 处理方式 | 说明 |
|------|----------|------|
| **重复报名** | 后端验证，返回错误信息 | 提示"您已报名该活动" |
| **重复签到** | 后端验证，返回错误信息 | 提示"您已签到" |
| **重复加入队伍** | 后端验证，返回错误信息 | 提示"您已加入队伍" |
| **重复投票** | 后端验证，返回错误信息 | 提示"您已对该作品投票" |
| **投票数量超限** | 后端验证，返回错误信息 | 提示"您已达到投票数量上限" |

### 8.5 队伍管理场景

| 场景 | 处理方式 | 说明 |
|------|----------|------|
| **队伍满员** | 隐藏"加入"按钮，显示提示信息 | 提示"队伍已满员" |
| **队长移除自己** | 禁止操作，显示提示信息 | 提示"不能移除自己" |
| **解散队伍** | 需确认操作，解散后所有成员恢复未组队状态 | 确认对话框："确定要解散队伍吗？解散后所有成员将恢复未组队状态" |
| **退出队伍** | 需确认操作，退出后可以重新组队 | 确认对话框："确定要退出队伍吗？退出后可以重新组队" |

---

## 9. 权限验证规则

### 9.1 前端权限控制

| 控制项 | 实现方式 | 说明 |
|--------|----------|------|
| **路由守卫** | 根据用户登录状态和活动阶段控制路由访问 | 在路由守卫中验证用户状态和活动阶段 |
| **按钮显示** | 根据用户状态和活动阶段显示/隐藏按钮 | 在组件中根据条件渲染按钮 |
| **操作提示** | 无权限操作时显示提示信息 | 提示用户无权限执行该操作或需要满足的条件 |
| **状态标签** | 根据用户状态显示状态标签 | 显示"已报名"、"已签到"、"已组队"等状态标签 |

### 9.2 后端权限验证

| 验证项 | 实现方式 | 说明 |
|--------|----------|------|
| **身份验证** | 验证用户钱包地址和签名 | 所有API接口都需要进行身份验证 |
| **状态验证** | 验证用户状态（已报名、已签到、已组队等） | 验证用户是否满足操作所需的状态 |
| **阶段验证** | 验证活动是否在相应阶段 | 验证活动是否在报名、签到、组队等阶段 |
| **时间验证** | 验证操作时间是否在时间范围内 | 验证报名、签到等操作是否在设定的时间范围内 |
| **角色验证** | 验证用户角色（队长/队员） | 验证用户是否有权限执行操作（如：只有队长可以提交作品） |
| **重复操作验证** | 验证用户是否已执行过该操作 | 验证用户是否已报名、已签到、已投票等 |
| **操作日志记录** | 记录所有重要操作 | 记录操作时间、操作人、操作内容等，便于审计 |

### 9.3 权限验证流程

```
1. 用户发起操作请求
2. 前端路由守卫验证（如有）
3. 前端按钮权限验证（显示/隐藏）
4. 后端中间件验证用户身份（钱包地址和签名）
5. 后端控制器验证用户状态（已报名、已签到、已组队等）
6. 后端控制器验证活动阶段（报名、签到、组队等）
7. 后端控制器验证时间范围（操作时间是否在范围内）
8. 后端控制器验证操作权限（如：只有队长可以提交作品）
9. 后端服务层验证重复操作（如：是否已报名、已投票等）
10. 执行操作并记录日志
11. 返回操作结果
```

---

## 10. 实现建议

### 10.1 前端实现建议

1. **状态管理**
   - 使用状态管理工具（如 Redux、Zustand）存储用户状态（登录状态、报名状态、签到状态、组队状态等）
   - 登录成功后保存用户钱包地址和状态到状态管理中
   - 页面刷新时从后端获取用户状态

2. **权限组件封装**
   - 封装权限控制组件，根据用户状态和活动阶段显示/隐藏内容
   - 封装权限路由守卫，控制路由访问
   - 封装权限按钮组件，根据权限显示/隐藏按钮

3. **Metamask 集成**
   - 封装 Metamask 连接逻辑到工具函数中
   - 监听 Metamask 账户切换事件
   - 处理 Metamask 连接错误和异常情况

4. **阶段状态管理**
   - 实时获取活动当前阶段
   - 根据活动阶段动态显示/隐藏功能按钮
   - 处理阶段切换时的状态更新

### 10.2 后端实现建议

1. **中间件设计**
   - 实现身份验证中间件（验证钱包地址和签名）
   - 实现状态验证中间件（验证用户状态）
   - 实现阶段验证中间件（验证活动阶段）
   - 实现时间验证中间件（验证操作时间范围）

2. **服务层设计**
   - 封装用户状态管理逻辑到服务层
   - 封装活动阶段管理逻辑到服务层
   - 封装投票统计逻辑到服务层
   - 提供统一的状态查询接口

3. **数据模型设计**
   - 用户表：存储钱包地址、用户信息等
   - 报名表：存储报名记录（用户地址、活动ID、报名时间）
   - 签到表：存储签到记录（用户地址、活动ID、签到时间）
   - 队伍表：存储队伍信息（队伍名称、成员上限、创建时间等）
   - 队伍成员表：存储队伍成员关系（队伍ID、用户地址、角色、加入时间）
   - 作品表：存储作品信息（作品名称、描述、链接、队伍ID、提交时间等）
   - 投票表：存储投票记录（用户地址、作品ID、投票时间）

4. **操作日志**
   - 记录所有重要操作（报名、签到、组队、提交、投票等）
   - 记录操作时间、操作人、操作内容、操作结果等
   - 支持操作日志查询和审计

---

## 附录：权限矩阵总览表

### A.1 页面访问权限总览

| 页面 | 未登录 | 已登录 | 已报名 | 已签到 | 已组队 | 队长 |
|------|--------|--------|--------|--------|--------|------|
| 首页/活动列表 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 活动详情 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 登录页面 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 我的活动 | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 报名页面 | ❌ | ⚠️ | ❌ | ❌ | ❌ | ❌ |
| 签到页面 | ❌ | ⚠️ | ⚠️ | ❌ | ❌ | ❌ |
| 组队页面 | ❌ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ⚠️ |
| 创建队伍 | ❌ | ⚠️ | ⚠️ | ⚠️ | ❌ | ❌ |
| 队伍详情 | ❌ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ⚠️ |
| 作品提交 | ❌ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ⚠️ |
| 作品列表 | ❌ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ⚠️ |
| 投票页面 | ❌ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ⚠️ |
| 结果页面 | ❌ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ⚠️ |
| 个人中心 | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ |

### A.2 核心操作权限总览

| 操作 | 未登录 | 已登录 | 已报名 | 已签到 | 已组队 | 队长 |
|------|--------|--------|--------|--------|--------|------|
| 连接钱包 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 断开连接 | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看活动 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 报名 | ❌ | ⚠️ | ❌ | ❌ | ❌ | ❌ |
| 签到 | ❌ | ⚠️ | ⚠️ | ❌ | ❌ | ❌ |
| 创建队伍 | ❌ | ⚠️ | ⚠️ | ⚠️ | ❌ | ❌ |
| 加入队伍 | ❌ | ⚠️ | ⚠️ | ⚠️ | ❌ | ❌ |
| 管理队伍 | ❌ | ⚠️ | ⚠️ | ⚠️ | ❌ | ⚠️ |
| 提交作品 | ❌ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ⚠️ |
| 修改作品 | ❌ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ⚠️ |
| 投票 | ❌ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ⚠️ |
| 查看结果 | ❌ | ⚠️ | ⚠️ | ⚠️ | ⚠️ | ⚠️ |

**图例说明**：
- ✅ 可以执行
- ❌ 不能执行
- ⚠️ 有条件执行（需满足特定条件，如：已登录、已报名、特定阶段等）

---

**文档维护说明**：
- 本文档基于 PRD-102 需求文档细化 Arena 平台参赛者功能模块
- 如有需求变更，请及时更新本文档
- 建议与开发团队确认功能细节后再实施
- 权限验证规则需前后端协同实现

