# PRD-401: Hackathon 比赛平台 - 第四期需求文档

## 1. 项目概述

### 1.1 项目背景
本项目旨在构建一个完整的 Hackathon（黑客松）比赛平台，支持主办方、参赛者和赞助商三方协同参与。平台分为两个独立的应用系统：
- **Hackathon Admin Platform**：供主办方和赞助商使用，用于活动管理和人员管理
- **Hackathon Arena Platform**：供参赛者使用，用于参与比赛的全流程操作

项目将分若干期完成，本 PRD 涵盖第四期的区块链集成功能需求，全面支持活动信息上链和资金链路上链。

### 1.2 项目目标
第四期主要实现区块链技术的全面集成，包括：
- 活动信息的链上同步和验证机制
- 参赛者签到和投票信息的链上记录
- NFT 发放机制
- 智能合约托管奖金系统
- 奖金自动分发机制
- 资金链路的透明化查询

### 1.3 项目范围
本 PRD 涵盖第四期开发需求，包括：
- 活动信息上链功能（增删改查同步）
- 签到信息上链及防重校验
- 投票信息上链及撤销机制
- NFT 发放功能
- 活动信息真实性验证
- 智能合约奖金托管
- 奖金自动分发
- 赞助商资金管理
- 奖金分成比例设置
- 资金链路查询功能

## 2. 用户角色定义

### 2.1 主办方（Organizer）
- **描述**：负责创建和管理 Hackathon 活动的组织或个人
- **权限**：
  - 在 Admin 平台增删改查活动，链上同步记录
  - 在 Arena 平台签到阶段为参赛者发放 NFT
  - 创建活动时创建智能合约托管奖金
  - 活动结果公布后触发奖金分发
  - 审核赞助商申请，批准或驳回赞助申请
- **登录方式**：账号密码登录

### 2.2 参赛者（Participant）
- **描述**：参与 Hackathon 比赛的个人或团队
- **权限**：
  - 在签到阶段进行签到，签到信息同步到链上
  - 接收主办方发放的 NFT
  - 在投票阶段进行投票，投票信息同步到链上，支持撤销操作
  - 在活动中验证当前活动信息的真实性（活动本身和投票记录）
  - 活动后在过往活动列表中验证活动信息的真实性
  - 在组队时设置奖金分成比例
  - 活动结果公布后接收奖金分配
- **登录方式**：Metamask 钱包登录

### 2.3 长期赞助商（Long-term Sponsor）
- **描述**：与平台建立长期合作关系的赞助商
- **权限**：
  - 申请活动时输入赞助金额，创建智能合约托管奖金
  - 申请通过后，赞助金额转入主办方钱包
  - 申请被驳回后，智能合约托管奖金原路返回
  - 查询资金链路信息
- **登录方式**：账号密码登录

### 2.4 指定活动赞助商（Event-specific Sponsor）
- **描述**：针对特定活动进行赞助的赞助商
- **权限**：
  - 赞助某活动时输入赞助金额，创建智能合约托管奖金
  - 申请被驳回后，智能合约托管奖金原路返回
  - 赞助资金分发方式等比例复制活动本身的分发方式
  - 查询资金链路信息
- **登录方式**：账号密码登录

### 2.5 游客（Visitor）
- **描述**：未登录的用户
- **权限**：
  - 在过往活动列表中验证活动信息的真实性（活动本身和投票记录）
- **登录方式**：无需登录

## 3. 功能需求

### 3.1 活动信息上链

#### 3.1.1 Admin 平台 - 主办方功能

##### 3.1.1.1 活动创建上链
- **功能描述**：主办方创建活动时，活动信息同步到区块链
- **输入**：活动基本信息（活动名称、描述、时间、地点等）
- **处理逻辑**：
  1. 主办方在 Admin 平台创建活动
  2. 系统验证活动信息完整性
  3. 将活动信息写入区块链
  4. 记录交易哈希（Transaction Hash）
  5. 返回创建结果
- **输出**：活动创建成功，链上记录交易哈希
- **异常处理**：
  - 如果链上写入失败，活动创建失败，提示用户重试
  - 如果钱包余额不足（用于支付 Gas 费），提示用户充值

##### 3.1.1.2 活动编辑上链
- **功能描述**：主办方编辑活动时，修改信息同步到区块链
- **输入**：活动 ID、修改后的活动信息
- **处理逻辑**：
  1. 主办方在 Admin 平台编辑活动
  2. 系统验证修改权限
  3. 将修改后的活动信息写入区块链（记录变更历史）
  4. 记录交易哈希
  5. 返回编辑结果
- **输出**：活动编辑成功，链上记录变更交易哈希
- **异常处理**：
  - 如果活动已进入不可编辑阶段，禁止编辑
  - 如果链上写入失败，编辑失败，提示用户重试

##### 3.1.1.3 活动删除上链
- **功能描述**：主办方删除活动时，删除操作同步到区块链
- **输入**：活动 ID
- **处理逻辑**：
  1. 主办方在 Admin 平台删除活动
  2. 系统验证删除权限和活动状态
  3. 将删除操作记录写入区块链
  4. 记录交易哈希
  5. 返回删除结果
- **输出**：活动删除成功，链上记录删除交易哈希
- **异常处理**：
  - 如果活动已开始或已结束，禁止删除
  - 如果链上写入失败，删除失败，提示用户重试

##### 3.1.1.4 活动查询上链
- **功能描述**：查询活动信息时，同时显示链上记录
- **输入**：活动 ID
- **处理逻辑**：
  1. 从数据库查询活动信息
  2. 从区块链查询活动链上记录
  3. 对比数据库和链上数据的一致性
  4. 显示活动信息和链上交易哈希
- **输出**：活动详细信息 + 链上交易哈希列表
- **注意事项**：
  - 活动阶段信息不需要同步至链上
  - 仅活动基本信息（名称、描述、时间、地点等）需要上链

#### 3.1.2 Arena 平台 - 主办方功能

##### 3.1.2.1 NFT 发放
- **功能描述**：在签到阶段，主办方为已签到的参赛者发放 NFT
- **输入**：参赛者钱包地址、活动 ID
- **处理逻辑**：
  1. 主办方在 Arena 平台查看已签到参赛者列表
  2. 选择参赛者进行 NFT 发放
  3. 系统调用智能合约发放 NFT
  4. 记录 NFT 交易哈希
  5. 更新参赛者 NFT 持有状态
- **输出**：NFT 发放成功，显示交易哈希
- **异常处理**：
  - 如果参赛者未签到，禁止发放 NFT
  - 如果 NFT 合约调用失败，提示错误信息
  - 如果钱包余额不足，提示主办方充值

#### 3.1.3 Arena 平台 - 参赛者功能

##### 3.1.3.1 签到信息上链
- **功能描述**：参赛者签到时，签到信息同步到区块链
- **输入**：参赛者钱包地址、活动 ID
- **处理逻辑**：
  1. 参赛者在 Arena 平台进行签到操作
  2. 系统验证活动是否处于签到阶段
  3. 系统进行防重校验（检查链上是否已有该参赛者的签到记录）
  4. 如果未重复，将签到信息写入区块链
  5. 记录交易哈希
  6. 更新本地数据库签到状态
- **输出**：签到成功，显示链上交易哈希
- **异常处理**：
  - 如果活动未进入签到阶段，提示错误
  - 如果链上已有签到记录（防重校验失败），提示已签到
  - 如果链上写入失败，签到失败，提示用户重试
- **防重校验规则**：
  - 检查区块链上该活动 ID + 参赛者钱包地址的唯一组合
  - 如果已存在，拒绝重复签到

##### 3.1.3.2 投票信息上链
- **功能描述**：参赛者投票时，投票信息同步到区块链
- **输入**：参赛者钱包地址、活动 ID、作品 ID、投票分数
- **处理逻辑**：
  1. 参赛者在 Arena 平台对作品进行投票
  2. 系统验证活动是否处于投票阶段
  3. 系统验证参赛者是否已投票（可选：每个作品只能投一次）
  4. 将投票信息写入区块链
  5. 记录交易哈希
  6. 更新本地数据库投票记录
- **输出**：投票成功，显示链上交易哈希
- **异常处理**：
  - 如果活动未进入投票阶段，提示错误
  - 如果链上写入失败，投票失败，提示用户重试
- **撤销投票功能**：
  - 参赛者可以撤销已投的票
  - 撤销操作也会同步到区块链
  - 撤销后，原投票记录标记为已撤销，但保留历史记录

##### 3.1.3.3 投票撤销
- **功能描述**：参赛者可以撤销已投的票
- **输入**：投票交易哈希、参赛者钱包地址
- **处理逻辑**：
  1. 参赛者在 Arena 平台查看自己的投票记录
  2. 选择要撤销的投票
  3. 系统验证投票是否可撤销（时间限制、活动状态等）
  4. 将撤销操作写入区块链
  5. 记录撤销交易哈希
  6. 更新本地数据库，标记投票为已撤销
- **输出**：投票撤销成功，显示撤销交易哈希
- **异常处理**：
  - 如果投票阶段已结束，禁止撤销
  - 如果链上写入失败，撤销失败，提示用户重试

##### 3.1.3.4 活动信息真实性验证（活动中）
- **功能描述**：参赛者在活动中验证当前活动信息的真实性
- **输入**：活动 ID
- **处理逻辑**：
  1. 参赛者在 Arena 平台选择"验证活动信息"
  2. 系统从数据库获取活动信息
  3. 系统从区块链获取活动链上记录
  4. 对比数据库和链上数据的一致性
  5. 显示验证结果（一致/不一致）
  6. 如果验证投票记录，则对比所有投票的链上记录
- **输出**：
  - 活动信息验证结果：一致/不一致
  - 投票记录验证结果：一致/不一致
  - 显示链上交易哈希列表
- **验证内容**：
  - 活动基本信息（名称、描述、时间、地点等）
  - 投票记录（所有投票的链上记录）

##### 3.1.3.5 活动信息真实性验证（活动后）
- **功能描述**：在过往活动列表中，任何用户（包括游客）可以验证活动信息的真实性
- **输入**：活动 ID
- **处理逻辑**：
  1. 用户在 Arena 平台过往活动列表中选择活动
  2. 选择"验证活动信息"功能
  3. 系统从数据库获取活动信息
  4. 系统从区块链获取活动链上记录
  5. 对比数据库和链上数据的一致性
  6. 显示验证结果
- **输出**：
  - 活动信息验证结果：一致/不一致
  - 投票记录验证结果：一致/不一致
  - 显示链上交易哈希列表
- **权限**：无需登录，游客也可以使用此功能

### 3.2 资金链路上链

#### 3.2.1 Admin 平台 - 主办方功能

##### 3.2.1.1 创建活动时托管奖金
- **功能描述**：主办方创建活动时，创建智能合约托管奖金
- **输入**：活动 ID、奖金总额、奖金分配规则
- **处理逻辑**：
  1. 主办方在创建活动时设置奖金总额
  2. 系统检查主办方钱包余额是否足够支付奖金总额 + Gas 费
  3. 如果余额不足，活动创建失败，提示用户充值
  4. 如果余额充足，创建智能合约，将奖金总额转入合约托管
  5. 记录合约地址和交易哈希
  6. 活动创建成功
- **输出**：活动创建成功，显示智能合约地址和托管交易哈希
- **异常处理**：
  - 如果钱包余额不足，活动创建失败，提示："钱包余额不足，需要至少 {奖金总额 + 预估 Gas 费} 的代币"
  - 如果智能合约创建失败，活动创建失败，提示用户重试
  - 如果 Gas 费不足，提示用户充值

##### 3.2.1.2 活动结果公布后奖金分发
- **功能描述**：活动比赛结果公布后，奖金根据比赛结果自动分发给对应队伍
- **输入**：活动 ID、比赛结果（队伍排名和对应奖金）
- **处理逻辑**：
  1. 主办方在 Admin 平台公布比赛结果
  2. 系统验证活动是否已结束
  3. 系统根据比赛结果计算各队伍应得奖金
  4. 调用智能合约，按照计算结果分发奖金到各队伍钱包
  5. 记录每笔分发的交易哈希
  6. 更新活动状态为"奖金已分发"
- **输出**：奖金分发成功，显示各队伍分发的交易哈希列表
- **异常处理**：
  - 如果活动未结束，禁止分发奖金
  - 如果智能合约余额不足，提示错误
  - 如果分发失败，记录失败信息，允许重试

#### 3.2.2 Admin 平台 - 长期赞助商功能

##### 3.2.2.1 申请活动时托管赞助金额
- **功能描述**：长期赞助商申请活动时，创建智能合约托管赞助金额
- **输入**：活动 ID、赞助金额
- **处理逻辑**：
  1. 赞助商在申请活动时输入赞助金额
  2. 系统检查赞助商钱包余额是否足够支付赞助金额 + Gas 费
  3. 如果余额不足，申请失败，提示用户充值
  4. 如果余额充足，创建智能合约，将赞助金额转入合约托管
  5. 记录合约地址和交易哈希
  6. 提交申请给主办方审核
- **输出**：申请提交成功，显示智能合约地址和托管交易哈希
- **异常处理**：
  - 如果钱包余额不足，申请失败，提示："钱包余额不足，需要至少 {赞助金额 + 预估 Gas 费} 的代币"
  - 如果智能合约创建失败，申请失败，提示用户重试

##### 3.2.2.2 申请通过后资金转入主办方钱包
- **功能描述**：主办方通过赞助申请后，赞助金额从智能合约转入主办方钱包
- **输入**：申请 ID、活动 ID
- **处理逻辑**：
  1. 主办方在 Admin 平台审核赞助申请，选择"通过"
  2. 系统调用智能合约，将托管的赞助金额转入主办方钱包
  3. 记录转账交易哈希
  4. 更新申请状态为"已通过"
  5. 通知赞助商申请已通过
- **输出**：申请通过，赞助金额已转入主办方钱包，显示交易哈希
- **异常处理**：
  - 如果智能合约余额不足，提示错误
  - 如果转账失败，记录错误，允许重试

##### 3.2.2.3 申请驳回后资金原路返回
- **功能描述**：主办方驳回赞助申请后，智能合约托管奖金原路返回给赞助商
- **输入**：申请 ID、活动 ID
- **处理逻辑**：
  1. 主办方在 Admin 平台审核赞助申请，选择"驳回"
  2. 系统调用智能合约，将托管的赞助金额原路返回给赞助商钱包
  3. 记录退款交易哈希
  4. 更新申请状态为"已驳回"
  5. 通知赞助商申请已驳回
- **输出**：申请驳回，赞助金额已原路返回，显示交易哈希
- **异常处理**：
  - 如果智能合约余额不足，提示错误
  - 如果退款失败，记录错误，允许重试

#### 3.2.3 Admin 平台 - 指定活动赞助商功能

##### 3.2.3.1 赞助活动时托管赞助金额
- **功能描述**：指定活动赞助商赞助某活动时，创建智能合约托管赞助金额
- **输入**：活动 ID、赞助金额
- **处理逻辑**：
  1. 赞助商在赞助某活动时输入赞助金额
  2. 系统检查赞助商钱包余额是否足够支付赞助金额 + Gas 费
  3. 如果余额不足，赞助失败，提示用户充值
  4. 如果余额充足，创建智能合约，将赞助金额转入合约托管
  5. 记录合约地址和交易哈希
  6. 提交赞助申请给主办方审核
- **输出**：赞助申请提交成功，显示智能合约地址和托管交易哈希
- **异常处理**：
  - 如果钱包余额不足，赞助失败，提示："钱包余额不足，需要至少 {赞助金额 + 预估 Gas 费} 的代币"
  - 如果智能合约创建失败，赞助失败，提示用户重试

##### 3.2.3.2 申请驳回后资金原路返回
- **功能描述**：主办方驳回指定活动赞助商的申请后，智能合约托管奖金原路返回
- **输入**：申请 ID、活动 ID
- **处理逻辑**：
  1. 主办方在 Admin 平台审核赞助申请，选择"驳回"
  2. 系统调用智能合约，将托管的赞助金额原路返回给赞助商钱包
  3. 记录退款交易哈希
  4. 更新申请状态为"已驳回"
  5. 通知赞助商申请已驳回
- **输出**：申请驳回，赞助金额已原路返回，显示交易哈希
- **异常处理**：
  - 如果智能合约余额不足，提示错误
  - 如果退款失败，记录错误，允许重试

##### 3.2.3.3 赞助资金分发方式
- **功能描述**：指定活动赞助商的赞助资金分发方式等比例复制活动本身的分发方式
- **输入**：活动 ID、赞助金额、活动奖金分配规则
- **处理逻辑**：
  1. 系统获取活动的奖金分配规则（如：第一名 50%，第二名 30%，第三名 20%）
  2. 将赞助金额按照相同的比例分配给对应名次的队伍
  3. 在活动结果公布后，同时分发活动奖金和赞助奖金
  4. 记录每笔分发的交易哈希
- **输出**：赞助奖金按照活动分配规则分发完成
- **示例**：
  - 活动奖金分配：第一名 50%，第二名 30%，第三名 20%
  - 赞助金额：1000 代币
  - 分发结果：第一名队伍 500 代币，第二名队伍 300 代币，第三名队伍 200 代币

#### 3.2.4 Arena 平台 - 参赛者功能

##### 3.2.4.1 活动结果公布后接收奖金
- **功能描述**：活动比赛结果公布后，参赛者队伍根据比赛结果接收奖金
- **输入**：活动 ID、队伍 ID
- **处理逻辑**：
  1. 活动结果公布后，系统自动调用智能合约分发奖金
  2. 奖金根据比赛结果分发给对应队伍的钱包地址
  3. 参赛者可以在 Arena 平台查看奖金接收记录
  4. 显示每笔奖金的交易哈希
- **输出**：奖金已到账，显示交易哈希和金额
- **异常处理**：
  - 如果队伍未获得名次，不接收奖金
  - 如果奖金分发失败，提示错误，等待重试

##### 3.2.4.2 设置奖金分成比例
- **功能描述**：在组队时，队长可以设置奖金分成比例
- **输入**：队伍 ID、各队员的分成比例
- **处理逻辑**：
  1. 队长在组队阶段设置奖金分成比例
  2. 系统验证分成比例总和是否为 100%
  3. 将分成比例信息写入智能合约（或数据库，在分发时读取）
  4. 如果队伍取得名次，奖金根据队长设置的分成比例再次自动分配给队员
  5. 调用智能合约，将奖金按比例分发给各队员钱包
  6. 记录每笔分发的交易哈希
- **输出**：分成比例设置成功，奖金已按比例分配给队员
- **异常处理**：
  - 如果分成比例总和不为 100%，提示错误
  - 如果只有队长一人，分成比例自动为 100%
  - 如果分发失败，记录错误，允许重试
- **示例**：
  - 队伍获得第一名，奖金 1000 代币
  - 队长设置分成比例：队长 40%，队员 A 30%，队员 B 30%
  - 分发结果：队长 400 代币，队员 A 300 代币，队员 B 300 代币

#### 3.2.5 资金链路查询功能

##### 3.2.5.1 Admin 平台资金链路查询
- **功能描述**：主办方和赞助商可以在 Admin 平台查询所有资金链路
- **输入**：活动 ID（可选）、时间范围（可选）
- **处理逻辑**：
  1. 用户在 Admin 平台选择"资金链路查询"
  2. 可以按活动 ID 或时间范围筛选
  3. 系统从区块链查询所有相关交易记录
  4. 显示资金流向图：创建活动托管 → 赞助商托管 → 资金转入 → 奖金分发
  5. 显示每笔交易的交易哈希、金额、时间、状态
- **输出**：资金链路列表，包括：
  - 活动奖金托管记录
  - 赞助商赞助记录
  - 资金转入转出记录
  - 奖金分发记录
  - 每笔交易的交易哈希

##### 3.2.5.2 Arena 平台资金链路查询
- **功能描述**：参赛者可以在 Arena 平台查询资金链路
- **输入**：活动 ID
- **处理逻辑**：
  1. 参赛者在 Arena 平台选择活动
  2. 选择"查看资金链路"
  3. 系统从区块链查询该活动的所有资金交易记录
  4. 显示资金流向和奖金分发情况
  5. 显示每笔交易的交易哈希
- **输出**：活动资金链路信息，包括：
  - 活动奖金总额
  - 赞助商赞助总额
  - 奖金分发记录（各队伍分配情况）
  - 每笔交易的交易哈希

## 4. 业务流程

### 4.1 活动创建和上链流程

```
主办方登录 Admin 平台
    ↓
创建活动（输入活动信息）
    ↓
设置奖金总额
    ↓
系统检查钱包余额
    ↓
[余额不足] → 提示充值 → 结束
    ↓
[余额充足]
    ↓
创建智能合约托管奖金
    ↓
将活动信息写入区块链
    ↓
记录交易哈希
    ↓
活动创建成功
```

### 4.2 参赛者签到和 NFT 发放流程

```
参赛者登录 Arena 平台
    ↓
进入活动签到页面
    ↓
点击签到按钮
    ↓
系统验证活动阶段（是否为签到阶段）
    ↓
[不是签到阶段] → 提示错误 → 结束
    ↓
[是签到阶段]
    ↓
系统进行防重校验（检查链上记录）
    ↓
[已签到] → 提示已签到 → 结束
    ↓
[未签到]
    ↓
将签到信息写入区块链
    ↓
记录交易哈希
    ↓
更新本地数据库
    ↓
主办方查看已签到列表
    ↓
选择参赛者发放 NFT
    ↓
调用 NFT 智能合约
    ↓
NFT 发放成功
```

### 4.3 投票和撤销流程

```
参赛者登录 Arena 平台
    ↓
进入活动投票页面
    ↓
查看作品列表
    ↓
对作品进行投票
    ↓
系统验证活动阶段（是否为投票阶段）
    ↓
[不是投票阶段] → 提示错误 → 结束
    ↓
[是投票阶段]
    ↓
将投票信息写入区块链
    ↓
记录交易哈希
    ↓
更新本地数据库
    ↓
投票成功
    ↓
[参赛者选择撤销投票]
    ↓
系统验证是否可撤销（时间限制、活动状态）
    ↓
[不可撤销] → 提示错误 → 结束
    ↓
[可撤销]
    ↓
将撤销操作写入区块链
    ↓
记录撤销交易哈希
    ↓
更新本地数据库（标记为已撤销）
    ↓
撤销成功
```

### 4.4 长期赞助商申请流程

```
长期赞助商登录 Admin 平台
    ↓
选择活动申请赞助
    ↓
输入赞助金额
    ↓
系统检查钱包余额
    ↓
[余额不足] → 提示充值 → 结束
    ↓
[余额充足]
    ↓
创建智能合约托管赞助金额
    ↓
记录合约地址和交易哈希
    ↓
提交申请给主办方
    ↓
主办方审核申请
    ↓
[通过]
    ↓
调用智能合约，将赞助金额转入主办方钱包
    ↓
记录转账交易哈希
    ↓
申请通过
    ↓
[驳回]
    ↓
调用智能合约，将赞助金额原路返回
    ↓
记录退款交易哈希
    ↓
申请驳回
```

### 4.5 指定活动赞助商赞助流程

```
指定活动赞助商登录 Admin 平台
    ↓
选择活动进行赞助
    ↓
输入赞助金额
    ↓
系统检查钱包余额
    ↓
[余额不足] → 提示充值 → 结束
    ↓
[余额充足]
    ↓
创建智能合约托管赞助金额
    ↓
记录合约地址和交易哈希
    ↓
提交赞助申请给主办方
    ↓
主办方审核申请
    ↓
[通过] → 等待活动结果公布后分发
    ↓
[驳回]
    ↓
调用智能合约，将赞助金额原路返回
    ↓
记录退款交易哈希
    ↓
申请驳回
```

### 4.6 活动结果公布和奖金分发流程

```
主办方登录 Admin 平台
    ↓
进入活动管理页面
    ↓
公布比赛结果（输入队伍排名）
    ↓
系统验证活动是否已结束
    ↓
[未结束] → 提示错误 → 结束
    ↓
[已结束]
    ↓
计算各队伍应得奖金（活动奖金 + 赞助奖金）
    ↓
调用智能合约分发活动奖金
    ↓
记录每笔分发的交易哈希
    ↓
[如果有指定活动赞助商]
    ↓
按照活动分配规则等比例分发赞助奖金
    ↓
记录每笔分发的交易哈希
    ↓
[如果队伍设置了分成比例]
    ↓
按照分成比例将奖金再次分配给队员
    ↓
记录每笔分发的交易哈希
    ↓
奖金分发完成
    ↓
参赛者在 Arena 平台查看奖金接收记录
```

### 4.7 活动信息验证流程

```
用户（参赛者/游客）进入 Arena 平台
    ↓
选择活动（当前活动或过往活动）
    ↓
点击"验证活动信息"
    ↓
系统从数据库获取活动信息
    ↓
系统从区块链获取活动链上记录
    ↓
对比活动基本信息（名称、描述、时间、地点等）
    ↓
对比投票记录（所有投票的链上记录）
    ↓
生成验证报告
    ↓
显示验证结果：
    - 活动信息：一致/不一致
    - 投票记录：一致/不一致
    - 链上交易哈希列表
```

### 4.8 资金链路查询流程

```
用户（主办方/赞助商/参赛者）登录平台
    ↓
进入资金链路查询页面
    ↓
[Admin 平台] 选择活动 ID 或时间范围筛选
    ↓
[Arena 平台] 选择活动 ID
    ↓
系统从区块链查询所有相关交易记录
    ↓
整理资金流向：
    - 活动奖金托管
    - 赞助商赞助
    - 资金转入转出
    - 奖金分发
    ↓
显示资金链路图
    ↓
显示每笔交易的详细信息：
    - 交易哈希
    - 金额
    - 时间
    - 状态
    - 发送方/接收方
```

## 5. 技术需求

### 5.1 区块链集成
- **区块链网络**：需要确定使用的区块链网络（如 Ethereum、Polygon、BSC 等）
- **智能合约**：
  - 活动信息存储合约
  - 奖金托管合约
  - NFT 发放合约
  - 投票记录合约
- **Gas 费管理**：需要考虑 Gas 费的支付方式（用户支付或平台补贴）

### 5.2 数据同步
- **链上链下数据一致性**：确保数据库和区块链数据的一致性
- **数据同步机制**：链上写入失败时的重试机制
- **数据验证机制**：定期验证链上链下数据一致性

### 5.3 安全性
- **防重校验**：签到和投票的防重机制
- **权限控制**：确保只有授权用户才能执行链上操作
- **交易签名**：所有链上操作需要用户签名确认

### 5.4 性能优化
- **批量操作**：支持批量发放 NFT、批量分发奖金
- **异步处理**：链上操作异步处理，避免阻塞用户操作
- **交易状态查询**：实时查询交易状态

## 6. 非功能需求

### 6.1 性能要求
- 链上操作响应时间：< 30 秒（不包括区块链确认时间）
- 数据查询响应时间：< 3 秒
- 支持并发用户数：≥ 1000

### 6.2 可靠性要求
- 链上操作成功率：≥ 99%
- 数据一致性：100%（链上链下数据必须一致）
- 系统可用性：≥ 99.5%

### 6.3 安全性要求
- 所有链上操作需要用户签名确认
- 敏感操作（如奖金分发）需要多重验证
- 交易记录不可篡改（区块链特性）

### 6.4 可维护性要求
- 所有链上交易记录可追溯
- 提供完整的资金链路查询功能
- 支持交易失败后的重试机制

## 7. 验收标准

### 7.1 活动信息上链
- ✅ 主办方增删改查活动时，链上同步记录成功
- ✅ 活动阶段信息不上链
- ✅ 签到信息上链，防重校验有效
- ✅ 投票信息上链，支持撤销操作
- ✅ 活动信息真实性验证功能正常
- ✅ NFT 发放功能正常

### 7.2 资金链路上链
- ✅ 创建活动时智能合约托管奖金成功
- ✅ 钱包余额不足时活动创建失败
- ✅ 活动结果公布后奖金自动分发成功
- ✅ 长期赞助商申请流程完整
- ✅ 指定活动赞助商赞助流程完整
- ✅ 奖金分成比例设置和分发正常
- ✅ 资金链路查询功能正常

### 7.3 用户体验
- ✅ 所有链上操作有明确的提示信息
- ✅ 交易哈希可查询和验证
- ✅ 错误信息清晰明确
- ✅ 操作流程顺畅

## 8. 风险评估

### 8.1 技术风险
- **区块链网络拥堵**：可能导致交易延迟或失败
  - **应对措施**：支持多链部署，提供交易加速功能
- **Gas 费波动**：可能导致用户操作成本增加
  - **应对措施**：提供 Gas 费预估，支持用户选择 Gas 价格
- **智能合约漏洞**：可能导致资金损失
  - **应对措施**：代码审计，使用成熟的智能合约模板

### 8.2 业务风险
- **用户钱包余额不足**：可能导致操作失败
  - **应对措施**：提前提示用户充值，提供余额检查功能
- **交易失败**：可能导致数据不一致
  - **应对措施**：实现重试机制，提供手动补偿功能

## 9. 后续规划

### 9.1 功能扩展
- 支持多链部署（跨链功能）
- 支持更多 NFT 类型和属性
- 支持代币质押和收益分配
- 支持去中心化投票机制

### 9.2 性能优化
- 实现 Layer 2 解决方案降低 Gas 费
- 优化智能合约减少 Gas 消耗
- 实现批量操作减少交易次数

---

**文档版本**: v1.0  
**创建日期**: 2024-01-XX  
**最后更新**: 2024-01-XX  
**维护人员**: 产品团队

