# DEV-101: Hackathon 比赛平台 - 开发文档

## 1. 文档说明

### 1.1 文档目的
本文档详细描述了 Hackathon 比赛平台第一期的技术实现方案，包括系统架构设计、数据库设计、API 接口设计、前端页面设计和开发规范。本文档作为开发团队的技术指导文档，确保开发工作按照统一的标准和规范进行。

### 1.2 文档范围
本文档涵盖以下内容：
- 系统整体架构设计
- 技术栈选型说明
- 数据库表结构设计
- API 接口详细设计
- 前端页面结构设计
- 开发规范和编码标准

本文档基于 PRD-101（精简版）的功能需求进行设计。

### 1.3 参考文档
- PRD-101: Hackathon 比赛平台 - 第一期需求文档（精简版）
- 开发文档模板 (tpl/dev.md)

## 2. 系统架构设计

### 2.1 整体架构

系统采用前后端分离架构，包含两个前端应用和一个后端服务：

```
┌─────────────────────────┐     ┌─────────────────────────┐
│  Hackathon Admin        │     │  Hackathon Arena        │
│  Platform (React)       │     │  Platform (React)       │
└──────────┬──────────────┘     └──────────┬──────────────┘
           │                               │
           │  HTTP/HTTPS                   │  HTTP/HTTPS
           │                               │
           └───────────────┬───────────────┘
                           │
                  ┌────────▼─────────┐
                  │   Backend API     │
                  │   (Go + Gin)      │
                  └────────┬───────────┘
                           │
                  ┌────────▼─────────┐
                  │     MySQL        │
                  │    Database      │
                  └──────────────────┘
```

**架构说明：**
- **前端应用**：两个独立的 React 应用
  - Hackathon Admin Platform：供主办方、赞助商、Admin 使用
  - Hackathon Arena Platform：供参赛者使用
- **后端服务**：统一的 RESTful API 服务，使用 Go + Gin 框架
- **数据库**：MySQL 关系型数据库
- **认证方式**：
  - Admin Platform：账号密码登录，使用 JWT Token
  - Arena Platform：Metamask 钱包登录，使用签名验证

### 2.2 技术栈选择

#### 2.2.1 前端技术栈

**Hackathon Admin Platform:**
- **框架**: React 18+
- **状态管理**: Redux Toolkit 或 Zustand
- **路由**: React Router v6
- **UI 组件库**: Ant Design 或 Material-UI
- **HTTP 客户端**: Axios
- **富文本编辑器**: React Quill 或 Draft.js
- **构建工具**: Vite 或 Create React App
- **包管理**: npm 或 yarn

**Hackathon Arena Platform:**
- **框架**: React 18+
- **状态管理**: Redux Toolkit 或 Zustand
- **路由**: React Router v6
- **UI 组件库**: Ant Design 或 Material-UI
- **HTTP 客户端**: Axios
- **Web3 集成**: ethers.js 或 web3.js（用于 Metamask 连接）
- **富文本编辑器**: React Quill 或 Draft.js
- **构建工具**: Vite 或 Create React App
- **包管理**: npm 或 yarn

#### 2.2.2 后端技术栈

- **语言**: Go 1.21+
- **Web 框架**: Gin
- **ORM**: GORM
- **数据库驱动**: mysql driver
- **认证**: JWT (JSON Web Token)
- **密码加密**: bcrypt
- **配置管理**: Viper
- **日志**: logrus 或 zap
- **API 文档**: Swagger/OpenAPI
- **任务调度**: cron（用于阶段自动切换）

#### 2.2.3 数据库

- **数据库类型**: MySQL 8.0+
- **字符集**: utf8mb4
- **排序规则**: utf8mb4_unicode_ci
- **连接池**: 使用 GORM 的连接池管理

#### 2.2.4 部署与运维

- **容器化**: Docker + Docker Compose
- **反向代理**: Nginx
- **进程管理**: Supervisor 或 systemd
- **监控**: 可选 Prometheus + Grafana
- **日志收集**: 可选 ELK Stack

## 3. 数据库设计

### 3.1 数据库概述

数据库名：`hackathon_db`

数据库设计遵循以下原则：
- 使用软删除（deleted_at）保留历史数据
- 所有表包含 created_at 和 updated_at 时间戳
- 使用外键约束保证数据完整性
- 合理使用索引提升查询性能

### 3.2 数据表设计

#### 3.2.1 users 表（管理员、主办方、赞助商）

存储 Admin、主办方、赞助商的账号信息。

```sql
CREATE TABLE `users` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `name` varchar(100) NOT NULL COMMENT '姓名',
  `email` varchar(255) NOT NULL COMMENT '邮箱（唯一）',
  `password` varchar(255) NOT NULL COMMENT '密码（bcrypt加密）',
  `role` enum('admin','organizer','sponsor') NOT NULL COMMENT '角色：admin-管理员，organizer-主办方，sponsor-赞助商',
  `phone` varchar(20) DEFAULT NULL COMMENT '手机号',
  `sponsor_id` bigint(20) unsigned DEFAULT NULL COMMENT '所属赞助商ID（仅赞助商角色）',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态：1-启用，0-禁用',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted_at` datetime DEFAULT NULL COMMENT '删除时间（软删除）',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_email` (`email`),
  KEY `idx_role` (`role`),
  KEY `idx_sponsor_id` (`sponsor_id`),
  KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表（管理员、主办方、赞助商）';
```

#### 3.2.2 participants 表（参赛者）

存储参赛者的钱包地址信息。

```sql
CREATE TABLE `participants` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '参赛者ID',
  `wallet_address` varchar(255) NOT NULL COMMENT '钱包地址（唯一）',
  `nonce` varchar(255) DEFAULT NULL COMMENT '签名随机数（用于Metamask登录验证）',
  `last_login_at` datetime DEFAULT NULL COMMENT '最后登录时间',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted_at` datetime DEFAULT NULL COMMENT '删除时间（软删除）',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_wallet_address` (`wallet_address`),
  KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='参赛者表';
```

#### 3.2.3 hackathons 表（活动）

存储 Hackathon 活动的基本信息。

```sql
CREATE TABLE `hackathons` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '活动ID',
  `name` varchar(100) NOT NULL COMMENT '活动名称',
  `description` text NOT NULL COMMENT '活动描述（富文本）',
  `start_time` datetime NOT NULL COMMENT '活动开始时间',
  `end_time` datetime NOT NULL COMMENT '活动结束时间',
  `location_type` enum('online','offline','hybrid') NOT NULL COMMENT '活动地点类型：online-线上，offline-线下，hybrid-混合',
  `location_detail` varchar(500) DEFAULT NULL COMMENT '具体地址（线下或混合时必填）',
  `status` enum('preparation','published','registration','checkin','team_formation','submission','voting','results') NOT NULL DEFAULT 'preparation' COMMENT '活动状态',
  `organizer_id` bigint(20) unsigned NOT NULL COMMENT '主办方ID',
  `max_team_size` int(11) NOT NULL DEFAULT '3' COMMENT '队伍最大成员数',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted_at` datetime DEFAULT NULL COMMENT '删除时间（软删除）',
  PRIMARY KEY (`id`),
  KEY `idx_organizer_id` (`organizer_id`),
  KEY `idx_status` (`status`),
  KEY `idx_start_time` (`start_time`),
  KEY `idx_deleted_at` (`deleted_at`),
  CONSTRAINT `fk_hackathons_organizer` FOREIGN KEY (`organizer_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='活动表';
```

#### 3.2.4 hackathon_stages 表（活动阶段时间）

存储活动各阶段的开始和结束时间。

```sql
CREATE TABLE `hackathon_stages` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '阶段ID',
  `hackathon_id` bigint(20) unsigned NOT NULL COMMENT '活动ID',
  `stage` enum('registration','checkin','team_formation','submission','voting') NOT NULL COMMENT '阶段类型',
  `start_time` datetime NOT NULL COMMENT '阶段开始时间',
  `end_time` datetime NOT NULL COMMENT '阶段结束时间',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_hackathon_stage` (`hackathon_id`,`stage`),
  KEY `idx_hackathon_id` (`hackathon_id`),
  CONSTRAINT `fk_stages_hackathon` FOREIGN KEY (`hackathon_id`) REFERENCES `hackathons` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='活动阶段时间表';
```

#### 3.2.5 hackathon_awards 表（活动奖项）

存储活动的奖项设置。

```sql
CREATE TABLE `hackathon_awards` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '奖项ID',
  `hackathon_id` bigint(20) unsigned NOT NULL COMMENT '活动ID',
  `name` varchar(100) NOT NULL COMMENT '奖项名称',
  `prize` varchar(255) NOT NULL COMMENT '奖金/奖品',
  `quantity` int(11) NOT NULL DEFAULT '1' COMMENT '数量',
  `rank` int(11) NOT NULL COMMENT '排名（用于排序）',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_hackathon_id` (`hackathon_id`),
  CONSTRAINT `fk_awards_hackathon` FOREIGN KEY (`hackathon_id`) REFERENCES `hackathons` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='活动奖项表';
```

#### 3.2.6 registrations 表（报名记录）

存储参赛者的报名记录。

```sql
CREATE TABLE `registrations` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '报名ID',
  `hackathon_id` bigint(20) unsigned NOT NULL COMMENT '活动ID',
  `participant_id` bigint(20) unsigned NOT NULL COMMENT '参赛者ID',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '报名时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_hackathon_participant` (`hackathon_id`,`participant_id`),
  KEY `idx_hackathon_id` (`hackathon_id`),
  KEY `idx_participant_id` (`participant_id`),
  CONSTRAINT `fk_registrations_hackathon` FOREIGN KEY (`hackathon_id`) REFERENCES `hackathons` (`id`),
  CONSTRAINT `fk_registrations_participant` FOREIGN KEY (`participant_id`) REFERENCES `participants` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='报名记录表';
```

#### 3.2.7 checkins 表（签到记录）

存储参赛者的签到记录。

```sql
CREATE TABLE `checkins` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '签到ID',
  `hackathon_id` bigint(20) unsigned NOT NULL COMMENT '活动ID',
  `participant_id` bigint(20) unsigned NOT NULL COMMENT '参赛者ID',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '签到时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_hackathon_participant` (`hackathon_id`,`participant_id`),
  KEY `idx_hackathon_id` (`hackathon_id`),
  KEY `idx_participant_id` (`participant_id`),
  CONSTRAINT `fk_checkins_hackathon` FOREIGN KEY (`hackathon_id`) REFERENCES `hackathons` (`id`),
  CONSTRAINT `fk_checkins_participant` FOREIGN KEY (`participant_id`) REFERENCES `participants` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='签到记录表';
```

#### 3.2.8 teams 表（队伍）

存储队伍信息。

```sql
CREATE TABLE `teams` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '队伍ID',
  `hackathon_id` bigint(20) unsigned NOT NULL COMMENT '活动ID',
  `name` varchar(50) NOT NULL COMMENT '队伍名称',
  `leader_id` bigint(20) unsigned NOT NULL COMMENT '队长ID（participant_id）',
  `max_size` int(11) NOT NULL DEFAULT '3' COMMENT '最大成员数',
  `status` enum('recruiting','locked') NOT NULL DEFAULT 'recruiting' COMMENT '队伍状态：recruiting-招募中，locked-已锁定',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted_at` datetime DEFAULT NULL COMMENT '删除时间（软删除）',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_hackathon_name` (`hackathon_id`,`name`),
  KEY `idx_hackathon_id` (`hackathon_id`),
  KEY `idx_leader_id` (`leader_id`),
  KEY `idx_deleted_at` (`deleted_at`),
  CONSTRAINT `fk_teams_hackathon` FOREIGN KEY (`hackathon_id`) REFERENCES `hackathons` (`id`),
  CONSTRAINT `fk_teams_leader` FOREIGN KEY (`leader_id`) REFERENCES `participants` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='队伍表';
```

#### 3.2.9 team_members 表（队伍成员）

存储队伍成员关系。

```sql
CREATE TABLE `team_members` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '成员ID',
  `team_id` bigint(20) unsigned NOT NULL COMMENT '队伍ID',
  `participant_id` bigint(20) unsigned NOT NULL COMMENT '参赛者ID',
  `role` enum('leader','member') NOT NULL DEFAULT 'member' COMMENT '角色：leader-队长，member-队员',
  `joined_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '加入时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_team_participant` (`team_id`,`participant_id`),
  KEY `idx_team_id` (`team_id`),
  KEY `idx_participant_id` (`participant_id`),
  CONSTRAINT `fk_team_members_team` FOREIGN KEY (`team_id`) REFERENCES `teams` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_team_members_participant` FOREIGN KEY (`participant_id`) REFERENCES `participants` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='队伍成员表';
```

#### 3.2.10 submissions 表（作品提交）

存储队伍提交的作品信息。

```sql
CREATE TABLE `submissions` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '作品ID',
  `hackathon_id` bigint(20) unsigned NOT NULL COMMENT '活动ID',
  `team_id` bigint(20) unsigned NOT NULL COMMENT '队伍ID',
  `name` varchar(100) NOT NULL COMMENT '作品名称',
  `description` text NOT NULL COMMENT '作品描述（富文本）',
  `link` varchar(500) NOT NULL COMMENT '作品链接（GitHub、演示地址等）',
  `draft` tinyint(1) NOT NULL DEFAULT '0' COMMENT '是否草稿：1-草稿，0-已提交',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_hackathon_team` (`hackathon_id`,`team_id`),
  KEY `idx_hackathon_id` (`hackathon_id`),
  KEY `idx_team_id` (`team_id`),
  CONSTRAINT `fk_submissions_hackathon` FOREIGN KEY (`hackathon_id`) REFERENCES `hackathons` (`id`),
  CONSTRAINT `fk_submissions_team` FOREIGN KEY (`team_id`) REFERENCES `teams` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='作品提交表';
```

#### 3.2.11 votes 表（投票记录）

存储参赛者的投票记录。

```sql
CREATE TABLE `votes` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '投票ID',
  `hackathon_id` bigint(20) unsigned NOT NULL COMMENT '活动ID',
  `participant_id` bigint(20) unsigned NOT NULL COMMENT '投票者ID',
  `submission_id` bigint(20) unsigned NOT NULL COMMENT '作品ID',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '投票时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_participant_submission` (`participant_id`,`submission_id`),
  KEY `idx_hackathon_id` (`hackathon_id`),
  KEY `idx_participant_id` (`participant_id`),
  KEY `idx_submission_id` (`submission_id`),
  CONSTRAINT `fk_votes_hackathon` FOREIGN KEY (`hackathon_id`) REFERENCES `hackathons` (`id`),
  CONSTRAINT `fk_votes_participant` FOREIGN KEY (`participant_id`) REFERENCES `participants` (`id`),
  CONSTRAINT `fk_votes_submission` FOREIGN KEY (`submission_id`) REFERENCES `submissions` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='投票记录表';
```

## 4. API 接口设计

### 4.1 API 设计规范

- **协议**: HTTP/HTTPS
- **数据格式**: JSON
- **字符编码**: UTF-8
- **请求方法**: 
  - GET: 查询数据
  - POST: 创建数据
  - PUT: 更新数据（全量更新）
  - PATCH: 更新数据（部分更新）
  - DELETE: 删除数据
- **URL 规范**: 
  - 使用 RESTful 风格
  - 使用复数名词，如 `/api/v1/hackathons`
  - 使用小写字母和连字符，如 `/api/v1/hackathon-stages`
- **版本控制**: URL 路径中包含版本号，如 `/api/v1/`
- **认证方式**:
  - Admin Platform: 使用 JWT Token，通过 `Authorization: Bearer <token>` 头部传递
  - Arena Platform: 使用钱包地址签名验证，通过请求体或头部传递签名信息

### 4.2 通用响应格式

**成功响应：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    // 响应数据
  }
}
```

**分页响应：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [],
    "pagination": {
      "page": 1,
      "page_size": 10,
      "total": 100,
      "total_pages": 10
    }
  }
}
```

**错误响应：**
```json
{
  "code": 400,
  "message": "错误描述",
  "data": null
}
```

**HTTP 状态码：**
- 200: 成功
- 201: 创建成功
- 400: 请求参数错误
- 401: 未认证
- 403: 无权限
- 404: 资源不存在
- 500: 服务器内部错误

### 4.3 API 接口描述

#### 4.3.1 Admin Platform API

##### 认证相关

**POST /api/v1/admin/auth/login**
- **描述**: 用户登录
- **请求体**:
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "jwt_token_string",
    "user": {
      "id": 1,
      "name": "张三",
      "email": "user@example.com",
      "role": "organizer"
    }
  }
}
```

**POST /api/v1/admin/auth/logout**
- **描述**: 用户登出
- **请求头**: `Authorization: Bearer <token>`
- **响应**: 标准成功响应

##### 人员管理（Admin 权限）

**POST /api/v1/admin/users**
- **描述**: 添加用户（主办方或赞助商）
- **权限**: Admin
- **请求体**:
```json
{
  "name": "李四",
  "email": "lisi@example.com",
  "password": "password123",
  "role": "organizer",
  "phone": "13800138000",
  "sponsor_id": null
}
```
- **响应**: 标准成功响应，包含创建的用户信息

**GET /api/v1/admin/users**
- **描述**: 获取用户列表
- **权限**: Admin
- **查询参数**:
  - `page`: 页码（默认1）
  - `page_size`: 每页数量（默认10）
  - `role`: 角色筛选（admin/organizer/sponsor）
  - `keyword`: 搜索关键词（姓名或邮箱）
- **响应**: 分页响应

**GET /api/v1/admin/users/:id**
- **描述**: 获取用户详情
- **权限**: Admin
- **响应**: 标准成功响应，包含用户信息

**PATCH /api/v1/admin/users/:id**
- **描述**: 更新用户信息
- **权限**: Admin
- **请求体**:
```json
{
  "name": "李四（更新）",
  "phone": "13900139000"
}
```
- **响应**: 标准成功响应

**DELETE /api/v1/admin/users/:id**
- **描述**: 删除用户（软删除）
- **权限**: Admin
- **响应**: 标准成功响应

##### 活动管理

**POST /api/v1/admin/hackathons**
- **描述**: 创建活动
- **权限**: Organizer
- **请求体**:
```json
{
  "name": "2024春季Hackathon",
  "description": "活动描述...",
  "start_time": "2024-03-01 09:00:00",
  "end_time": "2024-03-03 18:00:00",
  "location_type": "offline",
  "location_detail": "北京市朝阳区xxx",
  "max_team_size": 3,
  "awards": [
    {
      "name": "一等奖",
      "prize": "10000元",
      "quantity": 1,
      "rank": 1
    }
  ],
  "stages": [
    {
      "stage": "registration",
      "start_time": "2024-02-20 00:00:00",
      "end_time": "2024-02-28 23:59:59"
    }
  ]
}
```
- **响应**: 标准成功响应，包含创建的活动信息

**GET /api/v1/admin/hackathons**
- **描述**: 获取活动列表
- **权限**: Organizer
- **查询参数**:
  - `page`: 页码
  - `page_size`: 每页数量
  - `status`: 状态筛选
  - `keyword`: 搜索关键词（活动名称）
  - `sort`: 排序方式（created_at_asc/created_at_desc）
- **响应**: 分页响应

**GET /api/v1/admin/hackathons/:id**
- **描述**: 获取活动详情
- **权限**: Organizer
- **响应**: 标准成功响应，包含活动完整信息及统计

**PUT /api/v1/admin/hackathons/:id**
- **描述**: 更新活动（仅预备状态可更新）
- **权限**: Organizer
- **请求体**: 同创建活动
- **响应**: 标准成功响应

**DELETE /api/v1/admin/hackathons/:id**
- **描述**: 删除活动（仅预备状态可删除）
- **权限**: Organizer
- **响应**: 标准成功响应

**POST /api/v1/admin/hackathons/:id/publish**
- **描述**: 发布活动（从预备切换到发布）
- **权限**: Organizer
- **响应**: 标准成功响应

**POST /api/v1/admin/hackathons/:id/stages/:stage/switch**
- **描述**: 手动切换活动阶段
- **权限**: Organizer
- **路径参数**:
  - `stage`: 目标阶段（registration/checkin/team_formation/submission/voting/results）
- **响应**: 标准成功响应

#### 4.3.2 Arena Platform API

##### 认证相关

**POST /api/v1/arena/auth/connect**
- **描述**: Metamask 连接，获取签名随机数
- **请求体**:
```json
{
  "wallet_address": "0x1234..."
}
```
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "nonce": "random_string_for_signature"
  }
}
```

**POST /api/v1/arena/auth/verify**
- **描述**: 验证签名，完成登录
- **请求体**:
```json
{
  "wallet_address": "0x1234...",
  "signature": "0xabcd..."
}
```
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "jwt_token_string",
    "participant": {
      "id": 1,
      "wallet_address": "0x1234..."
    }
  }
}
```

##### 活动相关

**GET /api/v1/arena/hackathons**
- **描述**: 获取已发布的活动列表
- **查询参数**:
  - `page`: 页码
  - `page_size`: 每页数量
  - `status`: 状态筛选（published/registration/checkin/team_formation/submission/voting/results）
  - `keyword`: 搜索关键词
  - `sort`: 排序方式（time_asc/time_desc）
- **响应**: 分页响应

**GET /api/v1/arena/hackathons/:id**
- **描述**: 获取活动详情
- **响应**: 标准成功响应，包含活动信息及统计

##### 报名相关

**POST /api/v1/arena/hackathons/:id/register**
- **描述**: 报名参加活动
- **认证**: 需要钱包登录
- **响应**: 标准成功响应

**GET /api/v1/arena/hackathons/:id/registration-status**
- **描述**: 查询报名状态
- **认证**: 需要钱包登录
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "registered": true,
    "registered_at": "2024-02-25 10:00:00"
  }
}
```

##### 签到相关

**POST /api/v1/arena/hackathons/:id/checkin**
- **描述**: 签到
- **认证**: 需要钱包登录
- **响应**: 标准成功响应

**GET /api/v1/arena/hackathons/:id/checkin-status**
- **描述**: 查询签到状态
- **认证**: 需要钱包登录
- **响应**: 同报名状态

##### 组队相关

**POST /api/v1/arena/hackathons/:id/teams**
- **描述**: 创建队伍
- **认证**: 需要钱包登录
- **请求体**:
```json
{
  "name": "超级战队",
  "max_size": 3
}
```
- **响应**: 标准成功响应

**GET /api/v1/arena/hackathons/:id/teams**
- **描述**: 获取活动队伍列表
- **查询参数**:
  - `page`: 页码
  - `page_size`: 每页数量
  - `keyword`: 搜索关键词（队伍名称）
- **响应**: 分页响应

**GET /api/v1/arena/teams/:id**
- **描述**: 获取队伍详情
- **响应**: 标准成功响应

**POST /api/v1/arena/teams/:id/join**
- **描述**: 加入队伍
- **认证**: 需要钱包登录
- **响应**: 标准成功响应

**POST /api/v1/arena/teams/:id/leave**
- **描述**: 退出队伍
- **认证**: 需要钱包登录
- **响应**: 标准成功响应

**DELETE /api/v1/arena/teams/:id**
- **描述**: 解散队伍（仅队长）
- **认证**: 需要钱包登录
- **响应**: 标准成功响应

**DELETE /api/v1/arena/teams/:id/members/:member_id**
- **描述**: 移除队伍成员（仅队长）
- **认证**: 需要钱包登录
- **响应**: 标准成功响应

**PATCH /api/v1/arena/teams/:id**
- **描述**: 更新队伍信息（仅队长，组队阶段内）
- **认证**: 需要钱包登录
- **请求体**:
```json
{
  "name": "新队伍名称"
}
```
- **响应**: 标准成功响应

##### 作品提交相关

**POST /api/v1/arena/hackathons/:id/submissions**
- **描述**: 提交作品（仅队长）
- **认证**: 需要钱包登录
- **请求体**:
```json
{
  "name": "我的作品",
  "description": "作品描述...",
  "link": "https://github.com/xxx",
  "draft": false
}
```
- **响应**: 标准成功响应

**GET /api/v1/arena/hackathons/:id/submissions**
- **描述**: 获取活动作品列表（投票阶段可见）
- **查询参数**:
  - `page`: 页码
  - `page_size`: 每页数量
  - `keyword`: 搜索关键词
  - `sort`: 排序方式（created_at_asc/created_at_desc）
- **响应**: 分页响应

**GET /api/v1/arena/submissions/:id**
- **描述**: 获取作品详情
- **响应**: 标准成功响应

**PUT /api/v1/arena/submissions/:id**
- **描述**: 更新作品（提交阶段内，仅队长）
- **认证**: 需要钱包登录
- **请求体**: 同提交作品
- **响应**: 标准成功响应

##### 投票相关

**POST /api/v1/arena/submissions/:id/vote**
- **描述**: 投票
- **认证**: 需要钱包登录
- **响应**: 标准成功响应

**DELETE /api/v1/arena/submissions/:id/vote**
- **描述**: 取消投票（投票阶段内）
- **认证**: 需要钱包登录
- **响应**: 标准成功响应

**GET /api/v1/arena/hackathons/:id/votes**
- **描述**: 获取我的投票记录
- **认证**: 需要钱包登录
- **响应**: 标准成功响应，包含投票列表

##### 结果查看相关

**GET /api/v1/arena/hackathons/:id/results**
- **描述**: 获取比赛结果（公布结果阶段）
- **响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "rankings": [
      {
        "rank": 1,
        "team": {
          "id": 1,
          "name": "超级战队"
        },
        "submission": {
          "id": 1,
          "name": "我的作品"
        },
        "vote_count": 100,
        "award": {
          "name": "一等奖",
          "prize": "10000元"
        }
      }
    ],
    "statistics": {
      "total_votes": 500,
      "total_teams": 50,
      "total_submissions": 45
    }
  }
}
```

## 5. 前端页面设计

### 5.1 Hackathon Admin Platform 页面

#### 5.1.1 登录页面
- **路径**: `/login`
- **功能**: 
  - 账号密码登录表单
  - 错误提示显示
  - 登录成功后根据角色跳转

#### 5.1.2 人员管理页面（Admin）
- **路径**: `/admin/users`
- **功能**:
  - 用户列表展示（表格）
  - 添加用户按钮和表单（弹窗或页面）
  - 编辑用户功能
  - 删除用户功能（二次确认）
  - 搜索和筛选功能
  - 分页组件

#### 5.1.3 活动列表页面（Organizer）
- **路径**: `/admin/hackathons`
- **功能**:
  - 活动列表展示（卡片或表格）
  - 创建活动按钮
  - 活动状态筛选
  - 搜索功能
  - 排序功能
  - 分页组件
  - 批量操作（如批量归档）

#### 5.1.4 活动创建/编辑页面（Organizer）
- **路径**: `/admin/hackathons/create` 或 `/admin/hackathons/:id/edit`
- **功能**:
  - 活动基本信息表单
  - 富文本编辑器（活动描述）
  - 时间选择器（活动时间、各阶段时间）
  - 地点类型选择
  - 奖项设置（动态添加/删除）
  - 阶段时间设置（时间轴视图）
  - 保存草稿功能
  - 发布活动按钮

#### 5.1.5 活动详情页面（Organizer）
- **路径**: `/admin/hackathons/:id`
- **功能**:
  - 活动完整信息展示
  - 活动当前状态显示
  - 阶段时间轴展示
  - 统计信息展示（报名人数、签到人数、组队数量、提交作品数量）
  - 阶段切换按钮
  - 编辑按钮（仅预备状态显示）
  - 删除按钮（仅预备状态显示）

### 5.2 Hackathon Arena Platform 页面

#### 5.2.1 首页/活动列表页面
- **路径**: `/`
- **功能**:
  - 活动列表展示（卡片形式）
  - 活动状态筛选
  - 搜索功能
  - 排序功能
  - 分页组件
  - Metamask 连接按钮（顶部导航）

#### 5.2.2 活动详情页面
- **路径**: `/hackathons/:id`
- **功能**:
  - 活动完整信息展示
  - 活动当前阶段显示
  - 阶段时间轴展示
  - 统计信息展示
  - 根据当前阶段显示操作按钮：
    - 报名按钮（报名阶段）
    - 签到按钮（签到阶段）
    - 组队按钮（组队阶段）
    - 提交作品按钮（提交阶段，仅队长）
    - 投票按钮（投票阶段）
    - 查看结果按钮（公布结果阶段）

#### 5.2.3 组队页面
- **路径**: `/hackathons/:id/teams`
- **功能**:
  - 队伍列表展示
  - 创建队伍按钮和表单
  - 加入队伍按钮
  - 我的队伍信息展示
  - 队伍管理功能（队长）

#### 5.2.4 队伍详情页面
- **路径**: `/teams/:id`
- **功能**:
  - 队伍信息展示
  - 成员列表展示
  - 队伍管理操作（队长）：
    - 修改队伍信息
    - 移除成员
    - 解散队伍
  - 退出队伍按钮（队员）

#### 5.2.5 作品提交页面
- **路径**: `/hackathons/:id/submit`
- **功能**:
  - 作品信息表单
  - 富文本编辑器（作品描述）
  - URL 输入框（作品链接）
  - 保存草稿功能
  - 提交作品按钮

#### 5.2.6 作品列表页面（投票阶段）
- **路径**: `/hackathons/:id/submissions`
- **功能**:
  - 作品列表展示（卡片形式）
  - 搜索功能
  - 排序功能
  - 投票按钮（每个作品）
  - 已投票标识

#### 5.2.7 作品详情页面
- **路径**: `/submissions/:id`
- **功能**:
  - 作品完整信息展示
  - 队伍信息展示
  - 投票按钮
  - 得票数显示

#### 5.2.8 结果页面
- **路径**: `/hackathons/:id/results`
- **功能**:
  - 排名列表展示
  - 获奖队伍信息展示
  - 统计数据展示
  - 作品详情链接

#### 5.2.9 我的活动页面
- **路径**: `/my-hackathons`
- **功能**:
  - 已报名的活动列表
  - 活动状态显示
  - 快速操作入口

## 6. 开发规范

### 6.1 代码规范

#### 6.1.1 命名规范

**后端（Go）:**
- **包名**: 小写字母，简短有意义，如 `user`, `hackathon`
- **文件名**: 小写字母，使用下划线分隔，如 `user_service.go`
- **结构体**: 大驼峰命名，如 `User`, `Hackathon`
- **函数/方法**: 大驼峰命名（公开）或小驼峰命名（私有），如 `GetUser()`, `validateEmail()`
- **变量**: 小驼峰命名，如 `userName`, `hackathonID`
- **常量**: 大写下划线分隔，如 `MAX_TEAM_SIZE`, `STATUS_PUBLISHED`
- **接口**: 以 `I` 开头或使用 `-er` 后缀，如 `IUserService` 或 `UserService`

**前端（React/TypeScript）:**
- **组件名**: 大驼峰命名，如 `UserList`, `HackathonCard`
- **文件名**: 与组件名一致，如 `UserList.tsx`
- **函数/变量**: 小驼峰命名，如 `getUserList`, `userName`
- **常量**: 大写下划线分隔，如 `API_BASE_URL`, `MAX_TEAM_SIZE`
- **类型/接口**: 大驼峰命名，如 `User`, `Hackathon`
- **CSS 类名**: 小写字母，使用连字符，如 `user-list`, `hackathon-card`

#### 6.1.2 注释规范

**后端（Go）:**
- 包注释：每个包都应该有包注释
- 公开函数/方法：必须有注释说明功能、参数、返回值
- 复杂逻辑：必须有注释说明
- 使用 Go 标准注释格式

```go
// GetUserByID 根据用户ID获取用户信息
// 参数:
//   - id: 用户ID
// 返回:
//   - *User: 用户信息
//   - error: 错误信息
func GetUserByID(id uint64) (*User, error) {
    // 实现逻辑
}
```

**前端（TypeScript/React）:**
- 组件注释：说明组件用途和主要功能
- 函数注释：说明功能、参数、返回值
- 复杂逻辑：必须有注释说明
- 使用 JSDoc 格式

```typescript
/**
 * 获取用户列表
 * @param page 页码
 * @param pageSize 每页数量
 * @returns 用户列表数据
 */
const getUserList = async (page: number, pageSize: number) => {
  // 实现逻辑
}
```

### 6.2 API 规范

- **统一错误码**: 定义统一的错误码规范
- **请求验证**: 所有输入参数必须验证
- **响应格式**: 统一使用标准响应格式
- **分页规范**: 统一使用 page 和 page_size 参数
- **认证机制**: 
  - Admin Platform: JWT Token，有效期 24 小时
  - Arena Platform: 钱包签名验证，每次请求验证签名
- **限流**: 对 API 进行限流保护，防止恶意请求
- **日志记录**: 记录所有 API 请求和响应（敏感信息除外）

### 6.3 数据库规范

- **表命名**: 使用复数形式，小写字母，下划线分隔，如 `users`, `hackathons`
- **字段命名**: 小写字母，下划线分隔，如 `user_name`, `created_at`
- **主键**: 统一使用 `id`，类型为 `bigint(20) unsigned`
- **时间字段**: 统一使用 `created_at`, `updated_at`, `deleted_at`
- **软删除**: 统一使用 `deleted_at` 字段实现软删除
- **索引**: 
  - 主键自动创建索引
  - 外键字段创建索引
  - 常用查询字段创建索引
  - 唯一约束自动创建唯一索引
- **字符集**: 统一使用 `utf8mb4` 和 `utf8mb4_unicode_ci`
- **注释**: 所有表和字段必须有注释说明

**文档版本**: v1.0
**创建日期**: 2024-01-XX
**最后更新**: 2024-01-XX
**维护人员**: 开发团队

